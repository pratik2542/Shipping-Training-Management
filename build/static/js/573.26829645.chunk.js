"use strict";(self.webpackChunkddrops=self.webpackChunkddrops||[]).push([[573],{573:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var a=r(5043),i=r(35),n=r(6600),s=r(5316),l=r(6446),o=r(9347),c=r(1906),d=r(9252),m=r(3336),u=r(5865),p=r(8903),h=r(5795),x=r(5761),g=r(5472),v=r(6822),A=r(3612),j=r(3216),f=r(5496),y=r.n(f),b=r(3193),N=r(9190),S=r(598),D=r(7392),C=r(7970),P=r(8577),k=r(3217),W=r(155),I=r(579);const q=e=>{let{open:t,onClose:r,onSave:d,title:m}=e;const u=(0,a.useRef)(null);return(0,I.jsxs)(i.A,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,children:[(0,I.jsx)(n.A,{children:m}),(0,I.jsx)(s.A,{children:(0,I.jsx)(l.A,{sx:{border:"1px solid #ccc",borderRadius:1,mt:2,backgroundColor:"#fff"},children:(0,I.jsx)(y(),{ref:u,canvasProps:{width:500,height:200,className:"signature-canvas"}})})}),(0,I.jsxs)(o.A,{children:[(0,I.jsx)(c.A,{onClick:()=>{u.current&&u.current.clear()},color:"secondary",children:"Clear"}),(0,I.jsx)(c.A,{onClick:r,children:"Cancel"}),(0,I.jsx)(c.A,{onClick:()=>{if(u.current){const e=u.current.toDataURL();d(e),r()}},variant:"contained",children:"Save Signature"})]})]})},w=()=>{const e=(0,j.Zp)(),t=(0,j.zy)(),[r,i]=(0,a.useState)(!1),[n,s]=(0,a.useState)(null),[o,f]=(0,a.useState)({shipmentCode:"",shipmentDate:"",itemNo:"",itemName:"",lotNumber:"",quantities:"",receiverName:"",receiverSign:"",receiverDate:"",inspectorName:"",inspectorSign:"",inspectorDate:"",approverName:"",approverSign:"",approverDate:"",attachmentUrl:"",attachmentName:"",qualifiedManufacturer:"",landingBillNumber:"",remainingQuantity:0,unit:"",expiryDate:null,damageToPackaging:!1,damageToProduct:!1,totalQuantityAccepted:0,damageNotes:"",vendor:"",transportation:""}),[y,w]=(0,a.useState)(!1),[T,Q]=(0,a.useState)(""),[U,B]=(0,a.useState)(null),L=(0,a.useCallback)(((e,t,r)=>{if(!e||!t||!r)return"";const a=e.replace(/[^a-zA-Z0-9]/g,""),i=t.replace(/[^a-zA-Z0-9]/g,""),n=r.replace(/-/g,"");return`${a.slice(0,4)}-${i.slice(0,4)}-${n}`.toUpperCase()}),[]);(0,a.useEffect)((()=>{(async()=>{try{const r="true"===localStorage.getItem("isTestUser")?A.B:v.db,a="true"===localStorage.getItem("isTestUser")?"test_shipments":"shipments",n=new URLSearchParams(t.search).get("edit");if(n){console.log("Loading record with ID:",n);const t=(0,g.H9)(r,a,n),l=await(0,g.x7)(t);if(l.exists()){const e=l.data();console.log("Loaded record data:",e),i(!0),s(n),f({id:e.id||"",shipmentCode:e.shipmentCode||"",shipmentDate:e.shipmentDate||"",itemNo:e.itemNo||"",itemName:e.itemName||"",lotNumber:e.lotNumber||"",quantities:e.quantities||"",receiverName:e.receiverName||"",receiverSign:e.receiverSign||"",receiverDate:e.receiverDate||"",inspectorName:e.inspectorName||"",inspectorSign:e.inspectorSign||"",inspectorDate:e.inspectorDate||"",approverName:e.approverName||"",approverSign:e.approverSign||"",approverDate:e.approverDate||"",attachmentUrl:e.attachmentUrl||"",attachmentName:e.attachmentName||"",qualifiedManufacturer:e.qualifiedManufacturer||"",landingBillNumber:e.landingBillNumber||"",remainingQuantity:e.remainingQuantity||0,unit:e.unit||"",expiryDate:e.expiryDate||null,damageToPackaging:e.damageToPackaging||!1,damageToProduct:e.damageToProduct||!1,totalQuantityAccepted:e.totalQuantityAccepted||0,damageNotes:e.damageNotes||"",vendor:e.vendor||"",transportation:e.transportation||""}),B(e)}else console.error("No document found with ID:",n),alert("Record not found"),e("/records")}else i(!1),s(null),f({shipmentCode:"",shipmentDate:"",itemNo:"",itemName:"",lotNumber:"",quantities:"",receiverName:"",receiverSign:"",receiverDate:"",inspectorName:"",inspectorSign:"",inspectorDate:"",approverName:"",approverSign:"",approverDate:"",attachmentUrl:"",attachmentName:"",qualifiedManufacturer:"",landingBillNumber:"",remainingQuantity:0,unit:"",expiryDate:null,damageToPackaging:!1,damageToProduct:!1,totalQuantityAccepted:0,damageNotes:"",vendor:"",transportation:""})}catch(r){console.error("Error loading record:",r),alert("Error loading record"),e("/records")}})()}),[t.search,e]);const z=e=>{const{name:t,value:r,type:a,checked:i}=e.target,n="checkbox"===a?i:r;f((e=>{const a={...e,[t]:n};if("quantities"===t&&(a.remainingQuantity=Number(r),a.totalQuantityAccepted=Number(r)),["itemNo","lotNumber","shipmentDate"].includes(t)){const e=L("itemNo"===t?r:a.itemNo,"lotNumber"===t?r:a.lotNumber,"shipmentDate"===t?r:a.shipmentDate);a.shipmentCode=e}return a}))},M=e=>{Q(e),w(!0)},R=e=>{if(!r)return e.startsWith("receiver");switch((null===U||void 0===U?void 0:U.status)||"Pending Shipment"){case"Pending Shipment":return e.startsWith("receiver");case"Pending Inspection":return e.startsWith("inspector");case"Pending Approval":return e.startsWith("approver");default:return!1}},F=e=>{if(!r)return"receiver"===e;switch((null===U||void 0===U?void 0:U.status)||"Pending Shipment"){case"Pending Shipment":default:return"receiver"===e;case"Pending Inspection":return"receiver"===e||"inspector"===e;case"Pending Approval":case"Approved":return"receiver"===e||"inspector"===e||"approver"===e}};return(0,I.jsx)(d.A,{maxWidth:"md",children:(0,I.jsxs)(m.A,{elevation:3,sx:{p:4,mt:4},children:[(0,I.jsxs)(l.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},gap:2,mb:4},children:[(0,I.jsxs)(l.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",sm:"auto"}},children:[(0,I.jsx)(c.A,{fullWidth:!0,variant:"outlined",onClick:()=>e("/dashboard"),children:"Dashboard"}),(0,I.jsx)(c.A,{fullWidth:!0,variant:"outlined",onClick:()=>{try{e("/records")}catch(t){console.error("Navigation error:",t),window.location.href="/records"}},children:"Back to Records"})]}),(0,I.jsx)(u.A,{variant:"h4",sx:{textAlign:{xs:"center",sm:"right"},color:"primary.main",fontSize:{xs:"1.5rem",sm:"2rem"}},children:r?"Edit Shipping Form":"New Shipping Form"})]}),(0,I.jsx)(l.A,{component:"form",onSubmit:async t=>{t.preventDefault();try{const t="true"===localStorage.getItem("isTestUser"),a=t?A.B:v.db,i=t?"test_shipments":"shipments";let s={...o,lastUpdated:(new Date).toISOString(),isTestData:t};if(!r){let e=1;if(!t){const t=(0,g.P)((0,g.rJ)(v.db,"shipments"),(0,g.My)("numericId","desc"),(0,g.AB)(1)),r=await(0,g.GG)(t);if(!r.empty){const t=r.docs[0].data();e=(parseInt(t.numericId)||0)+1}}s={...s,id:e.toString(),numericId:e,uniqueId:`${e}-${Date.now()}`,createdAt:(new Date).toISOString()}}let l=["shipmentDate","itemNo","itemName","lotNumber","quantities"];r&&o.receiverSign?R("inspectorName")?l=[...l,"inspectorName"]:R("approverName")&&(l=[...l,"approverName"]):l=[...l,"receiverName"];const c=l.filter((e=>!o[e]));if(c.length>0)return void alert(`Please fill in all required fields: ${c.join(", ")}`);const d=o.approverSign?"Approved":o.inspectorSign?"Pending Approval":o.receiverSign?"Pending Inspection":"Pending Shipment";s={...s,status:d},r&&n?await(0,g.mZ)((0,g.H9)(a,i,n),s):await(0,g.gS)((0,g.rJ)(a,i),s),alert(`Form ${r?"updated":"submitted"} successfully!`),e("/records")}catch(a){console.error("Error submitting form:",a);const e=(null===a||void 0===a?void 0:a.message)||"Unknown error occurred";alert(`Error submitting form: ${e}. Please try again.`)}},children:(0,I.jsxs)(p.Ay,{container:!0,spacing:3,children:[(r||o.id)&&(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,disabled:!0,label:"ID",value:o.id||""})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,disabled:!0,label:"Shipment Code",value:o.shipmentCode||"",helperText:"Auto-generated from Item No, Lot No, and Date"})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,required:!0,type:"date",name:"shipmentDate",label:"Shipment Date",InputLabelProps:{shrink:!0},value:o.shipmentDate,onChange:z})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,required:!0,name:"itemNo",label:"Item Number",value:o.itemNo,onChange:z})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,required:!0,name:"itemName",label:"Item Name",value:o.itemName,onChange:z})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,required:!0,name:"lotNumber",label:"Lot Number",value:o.lotNumber,onChange:z})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,required:!0,name:"quantities",label:"Quantities",type:"number",value:o.quantities,onChange:z})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsxs)(b.A,{fullWidth:!0,children:[(0,I.jsx)(N.A,{children:"Qualified Manufacturer"}),(0,I.jsx)(S.A,{name:"qualifiedManufacturer",value:o.qualifiedManufacturer,onChange:z,label:"Qualified Manufacturer",required:!0,endAdornment:o.qualifiedManufacturer&&(0,I.jsx)(D.A,{size:"small",sx:{mr:4},onClick:()=>f((e=>({...e,qualifiedManufacturer:""}))),children:(0,I.jsx)(W.A,{fontSize:"small"})}),children:["UPS","Amazon","Purolator","Canada Post","FedEx","DHL"].map((e=>(0,I.jsx)(C.A,{value:e,children:e},e)))})]})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsxs)(b.A,{fullWidth:!0,children:[(0,I.jsx)(N.A,{children:"Vendor"}),(0,I.jsx)(S.A,{name:"vendor",value:o.vendor,onChange:z,label:"Vendor",required:!0,endAdornment:o.vendor&&(0,I.jsx)(D.A,{size:"small",sx:{mr:4},onClick:()=>f((e=>({...e,vendor:""}))),children:(0,I.jsx)(W.A,{fontSize:"small"})}),children:["Zomato","Swiggy","BlinkIt","Zepto"].map((e=>(0,I.jsx)(C.A,{value:e,children:e},e)))})]})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,label:"Transportation",name:"transportation",value:o.transportation,onChange:z,required:!0,placeholder:"Enter transportation details"})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,label:"Landing Bill Number",name:"landingBillNumber",value:o.landingBillNumber,onChange:z,required:!0})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,label:"Remaining Quantity",value:o.remainingQuantity,InputLabelProps:{shrink:!0},InputProps:{readOnly:!0},disabled:!0})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsxs)(b.A,{fullWidth:!0,children:[(0,I.jsx)(N.A,{children:"Unit"}),(0,I.jsx)(S.A,{name:"unit",value:o.unit,label:"Unit",onChange:z,required:!0,endAdornment:o.unit&&(0,I.jsx)(D.A,{size:"small",sx:{mr:4},onClick:()=>f((e=>({...e,unit:""}))),children:(0,I.jsx)(W.A,{fontSize:"small"})}),children:["KG","EA","Cylinder"].map((e=>(0,I.jsx)(C.A,{value:e,children:e},e)))})]})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,required:!0,type:"date",name:"expiryDate",label:"Expiry Date",InputLabelProps:{shrink:!0},value:o.expiryDate||"",onChange:e=>f((t=>({...t,expiryDate:e.target.value}))),sx:{width:"100%"}})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(h.A,{fullWidth:!0,label:"Total Quantity Accepted",name:"totalQuantityAccepted",type:"number",value:o.totalQuantityAccepted,onChange:z,required:!0})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(P.A,{control:(0,I.jsx)(k.A,{checked:o.damageToPackaging,onChange:z,name:"damageToPackaging"}),label:"Damage to Packaging"})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,I.jsx)(P.A,{control:(0,I.jsx)(k.A,{checked:o.damageToProduct,onChange:z,name:"damageToProduct"}),label:"Damage to Product"})}),(o.damageToPackaging||o.damageToProduct)&&(0,I.jsx)(p.Ay,{item:!0,xs:12,children:(0,I.jsx)(h.A,{fullWidth:!0,multiline:!0,rows:4,label:"Damage Notes",name:"damageNotes",value:o.damageNotes,onChange:z,required:!0})}),F("receiver")&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(p.Ay,{item:!0,xs:12,children:(0,I.jsx)(u.A,{variant:"h6",sx:{mb:2,mt:2},children:"Receiver Details"})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsx)(h.A,{fullWidth:!0,name:"receiverName",label:"Receiver Name",value:o.receiverName,onChange:z,disabled:!R("receiverName")})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsxs)(l.A,{sx:{width:"100%",mt:-3},children:[(0,I.jsx)(u.A,{variant:"subtitle2",sx:{marginBottom:"3px !important"},children:"Receiver Signature"}),o.receiverSign?(0,I.jsx)(l.A,{sx:{border:"1px solid #ccc",p:1,mb:1},children:(0,I.jsx)("img",{src:o.receiverSign,alt:"Receiver Signature",style:{maxWidth:"100%",height:"auto"}})}):null,R("receiverSign")&&(0,I.jsx)(c.A,{variant:"outlined",fullWidth:!0,onClick:()=>M("receiverSign"),children:o.receiverSign?"Change Signature":"Add Signature"})]})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsx)(h.A,{fullWidth:!0,type:"date",name:"receiverDate",label:"Receiver Date",InputLabelProps:{shrink:!0},value:o.receiverDate,InputProps:{readOnly:!0}})})]}),F("inspector")&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(p.Ay,{item:!0,xs:12,children:(0,I.jsx)(u.A,{variant:"h6",sx:{mb:2,mt:2},children:"Inspector Details"})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsx)(h.A,{fullWidth:!0,name:"inspectorName",label:"Inspector Name",value:o.inspectorName,onChange:z,disabled:!R("inspectorName")})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsxs)(l.A,{sx:{width:"100%",mt:-3},children:[(0,I.jsx)(u.A,{variant:"subtitle2",sx:{marginBottom:"3px !important"},children:"Inspector Signature"}),o.inspectorSign?(0,I.jsx)(l.A,{sx:{border:"1px solid #ccc",p:1,mb:1},children:(0,I.jsx)("img",{src:o.inspectorSign,alt:"Inspector Signature",style:{maxWidth:"100%",height:"auto"}})}):null,R("inspectorSign")&&(0,I.jsx)(c.A,{variant:"outlined",fullWidth:!0,onClick:()=>M("inspectorSign"),children:o.inspectorSign?"Change Signature":"Add Signature"})]})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsx)(h.A,{fullWidth:!0,type:"date",name:"inspectorDate",label:"Inspector Date",InputLabelProps:{shrink:!0},value:o.inspectorDate,InputProps:{readOnly:!0}})})]}),F("approver")&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(p.Ay,{item:!0,xs:12,children:(0,I.jsx)(u.A,{variant:"h6",sx:{mb:2,mt:2},children:"Approver Details"})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsx)(h.A,{fullWidth:!0,name:"approverName",label:"Approver Name",value:o.approverName,onChange:z,disabled:!R("approverName")})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsxs)(l.A,{sx:{width:"100%",mt:-3},children:[(0,I.jsx)(u.A,{variant:"subtitle2",sx:{marginBottom:"3px !important"},children:"Approver Signature"}),o.approverSign?(0,I.jsx)(l.A,{sx:{border:"1px solid #ccc",p:1,mb:1},children:(0,I.jsx)("img",{src:o.approverSign,alt:"Approver Signature",style:{maxWidth:"100%",height:"auto"}})}):null,R("approverSign")&&(0,I.jsx)(c.A,{variant:"outlined",fullWidth:!0,onClick:()=>M("approverSign"),children:o.approverSign?"Change Signature":"Add Signature"})]})}),(0,I.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,I.jsx)(h.A,{fullWidth:!0,type:"date",name:"approverDate",label:"Approver Date",InputLabelProps:{shrink:!0},value:o.approverDate,InputProps:{readOnly:!0}})})]}),(0,I.jsxs)(p.Ay,{item:!0,xs:12,children:[(0,I.jsx)(u.A,{variant:"h6",sx:{mb:2,mt:2},children:"Attachment (Optional - Max 1MB)"}),(0,I.jsx)(x.A,{type:"file",accept:"application/pdf",onChange:e=>{const t=e.target.files[0];if(t){if("application/pdf"!==t.type)return alert("Please upload only PDF files"),void(e.target.value="");if(t.size>1048576)return alert("File size should be less than 1MB"),void(e.target.value="");const r=new FileReader;r.onload=()=>{f((e=>({...e,attachmentUrl:r.result,attachmentName:t.name})))},r.readAsDataURL(t)}},sx:{mb:2}}),o.attachmentUrl&&(0,I.jsxs)(u.A,{variant:"body2",color:"primary",sx:{mt:1},children:["Current attachment: ",o.attachmentName||"PDF Document"]})]}),(0,I.jsx)(q,{open:y,onClose:()=>w(!1),onSave:e=>{const t=(new Date).toISOString().split("T")[0],r=T.replace("Sign","Date");f((a=>({...a,[T]:e,[r]:t}))),w(!1),Q(null)},title:`Add ${null===T||void 0===T?void 0:T.replace("Sign","")} Signature`}),(0,I.jsx)(p.Ay,{item:!0,xs:12,children:(0,I.jsx)(l.A,{sx:{display:"flex",gap:2,mt:2},children:(0,I.jsx)(c.A,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0,children:"Submit Form"})})})]})})]})})}}}]);
//# sourceMappingURL=573.26829645.chunk.js.map