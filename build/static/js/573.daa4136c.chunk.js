/*! For license information please see 573.daa4136c.chunk.js.LICENSE.txt */
(self.webpackChunkddrops=self.webpackChunkddrops||[]).push([[573],{573:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>S});var i=n(5043),r=n(35),o=n(6600),a=n(5316),s=n(6446),c=n(9347),l=n(1906),h=n(7872),u=n(3336),d=n(5865),p=n(8903),m=n(7424),v=n(5761),f=n(5472),x=n(6822),g=n(3612),y=n(3216),_=n(5496),b=n.n(_),w=n(579);const A=t=>{let{open:e,onClose:n,onSave:h,title:u}=t;const d=(0,i.useRef)(null);return(0,w.jsxs)(r.A,{open:e,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,w.jsx)(o.A,{children:u}),(0,w.jsx)(a.A,{children:(0,w.jsx)(s.A,{sx:{border:"1px solid #ccc",borderRadius:1,mt:2,backgroundColor:"#fff"},children:(0,w.jsx)(b(),{ref:d,canvasProps:{width:500,height:200,className:"signature-canvas"}})})}),(0,w.jsxs)(c.A,{children:[(0,w.jsx)(l.A,{onClick:()=>{d.current&&d.current.clear()},color:"secondary",children:"Clear"}),(0,w.jsx)(l.A,{onClick:n,children:"Cancel"}),(0,w.jsx)(l.A,{onClick:()=>{if(d.current){const t=d.current.toDataURL();h(t),n()}},variant:"contained",children:"Save Signature"})]})]})},S=()=>{const t=(0,y.Zp)(),e=(0,y.zy)(),[n,r]=(0,i.useState)(!1),[o,a]=(0,i.useState)(null),[c,_]=(0,i.useState)({shipmentCode:"",shipmentDate:"",itemNo:"",itemName:"",lotNumber:"",quantities:"",receiverName:"",receiverSign:"",receiverDate:"",inspectorName:"",inspectorSign:"",inspectorDate:"",approverName:"",approverSign:"",approverDate:"",attachmentUrl:"",attachmentName:""}),[b,S]=(0,i.useState)(!1),[D,P]=(0,i.useState)(""),[j,C]=(0,i.useState)(null),N=(0,i.useCallback)(((t,e,n)=>{if(!t||!e||!n)return"";const i=t.replace(/[^a-zA-Z0-9]/g,""),r=e.replace(/[^a-zA-Z0-9]/g,""),o=n.replace(/-/g,"");return`${i.slice(0,4)}-${r.slice(0,4)}-${o}`.toUpperCase()}),[]);(0,i.useEffect)((()=>{(async()=>{try{const n="true"===localStorage.getItem("isTestUser")?g.B:x.db,i="true"===localStorage.getItem("isTestUser")?"test_shipments":"shipments",o=new URLSearchParams(e.search).get("edit");if(o){console.log("Loading record with ID:",o);const e=(0,f.H9)(n,i,o),s=await(0,f.x7)(e);if(s.exists()){const t=s.data();console.log("Loaded record data:",t),r(!0),a(o),_({id:t.id||"",shipmentCode:t.shipmentCode||"",shipmentDate:t.shipmentDate||"",itemNo:t.itemNo||"",itemName:t.itemName||"",lotNumber:t.lotNumber||"",quantities:t.quantities||"",receiverName:t.receiverName||"",receiverSign:t.receiverSign||"",receiverDate:t.receiverDate||"",inspectorName:t.inspectorName||"",inspectorSign:t.inspectorSign||"",inspectorDate:t.inspectorDate||"",approverName:t.approverName||"",approverSign:t.approverSign||"",approverDate:t.approverDate||"",attachmentUrl:t.attachmentUrl||"",attachmentName:t.attachmentName||""}),C(t)}else console.error("No document found with ID:",o),alert("Record not found"),t("/records")}else r(!1),a(null),_({shipmentCode:"",shipmentDate:"",itemNo:"",itemName:"",lotNumber:"",quantities:"",receiverName:"",receiverSign:"",receiverDate:"",inspectorName:"",inspectorSign:"",inspectorDate:"",approverName:"",approverSign:"",approverDate:"",attachmentUrl:"",attachmentName:""})}catch(n){console.error("Error loading record:",n),alert("Error loading record"),t("/records")}})()}),[e.search,t]);const W=t=>{const{name:e,value:n}=t.target;_((t=>{const i={...t,[e]:n};if(["itemNo","lotNumber","shipmentDate"].includes(e)){const t=N("itemNo"===e?n:i.itemNo,"lotNumber"===e?n:i.lotNumber,"shipmentDate"===e?n:i.shipmentDate);i.shipmentCode=t}return i}))},k=t=>{P(t),S(!0)},E=t=>{if(!n)return t.startsWith("receiver");switch((null===j||void 0===j?void 0:j.status)||"Pending Shipment"){case"Pending Shipment":return t.startsWith("receiver");case"Pending Inspection":return t.startsWith("inspector");case"Pending Approval":return t.startsWith("approver");default:return!1}};return(0,w.jsx)(h.A,{maxWidth:"md",children:(0,w.jsxs)(u.A,{elevation:3,sx:{p:4,mt:4},children:[(0,w.jsxs)(s.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},gap:2,mb:4},children:[(0,w.jsxs)(s.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",sm:"auto"}},children:[(0,w.jsx)(l.A,{fullWidth:!0,variant:"outlined",onClick:()=>t("/dashboard"),children:"Dashboard"}),(0,w.jsx)(l.A,{fullWidth:!0,variant:"outlined",onClick:()=>{try{t("/records")}catch(e){console.error("Navigation error:",e),window.location.href="/records"}},children:"Back to Records"})]}),(0,w.jsx)(d.A,{variant:"h4",sx:{textAlign:{xs:"center",sm:"right"},color:"primary.main",fontSize:{xs:"1.5rem",sm:"2rem"}},children:n?"Edit Shipping Form":"New Shipping Form"})]}),(0,w.jsx)(s.A,{component:"form",onSubmit:async e=>{e.preventDefault();try{const e="true"===localStorage.getItem("isTestUser"),i=e?g.B:x.db,r=e?"test_shipments":"shipments";let a=1;if(e)a=1;else{const t=(0,f.P)((0,f.rJ)(x.db,"shipments"),(0,f.My)("numericId","desc"),(0,f.AB)(1)),e=await(0,f.GG)(t);if(!e.empty){const t=e.docs[0].data();a=(parseInt(t.numericId)||0)+1}}let s=["shipmentDate","itemNo","itemName","lotNumber","quantities"];n&&c.receiverSign?E("inspectorName")?s=[...s,"inspectorName"]:E("approverName")&&(s=[...s,"approverName"]):s=[...s,"receiverName"];const l=s.filter((t=>!c[t]));if(l.length>0)return void alert(`Please fill in all required fields: ${l.join(", ")}`);const h=c.approverSign?"Approved":c.inspectorSign?"Pending Approval":c.receiverSign?"Pending Inspection":"Pending Shipment",u={...c,id:a.toString(),numericId:a,uniqueId:`${a}-${Date.now()}`,shipmentCode:c.shipmentCode,status:h,lastUpdated:(new Date).toISOString(),isTestData:e};n&&o?await(0,f.mZ)((0,f.H9)(i,r,o),u):(u.createdAt=(new Date).toISOString(),await(0,f.gS)((0,f.rJ)(i,r),u)),alert(`Form ${n?"updated":"submitted"} successfully!`),t("/records")}catch(i){console.error("Error submitting form:",i);const t=(null===i||void 0===i?void 0:i.message)||"Unknown error occurred";alert(`Error submitting form: ${t}. Please try again.`)}},children:(0,w.jsxs)(p.Ay,{container:!0,spacing:3,children:[(n||c.id)&&(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,w.jsx)(m.A,{fullWidth:!0,disabled:!0,label:"ID",value:c.id||""})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,w.jsx)(m.A,{fullWidth:!0,disabled:!0,label:"Shipment Code",value:c.shipmentCode||"",helperText:"Auto-generated from Item No, Lot No, and Date"})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,w.jsx)(m.A,{fullWidth:!0,required:!0,type:"date",name:"shipmentDate",label:"Shipment Date",InputLabelProps:{shrink:!0},value:c.shipmentDate,onChange:W})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,w.jsx)(m.A,{fullWidth:!0,required:!0,name:"itemNo",label:"Item Number",value:c.itemNo,onChange:W})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,w.jsx)(m.A,{fullWidth:!0,required:!0,name:"itemName",label:"Item Name",value:c.itemName,onChange:W})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,w.jsx)(m.A,{fullWidth:!0,required:!0,name:"lotNumber",label:"Lot Number",value:c.lotNumber,onChange:W})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,w.jsx)(m.A,{fullWidth:!0,required:!0,name:"quantities",label:"Quantities",type:"number",value:c.quantities,onChange:W})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,children:(0,w.jsx)(d.A,{variant:"h6",sx:{mb:2,mt:2},children:"Receiver Details"})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(m.A,{fullWidth:!0,name:"receiverName",label:"Receiver Name",value:c.receiverName,onChange:W,disabled:!E("receiverName")})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsxs)(s.A,{sx:{width:"100%",mt:-3},children:[(0,w.jsx)(d.A,{variant:"subtitle2",sx:{marginBottom:"3px !important"},children:"Receiver Signature"}),c.receiverSign?(0,w.jsx)(s.A,{sx:{border:"1px solid #ccc",p:1,mb:1},children:(0,w.jsx)("img",{src:c.receiverSign,alt:"Receiver Signature",style:{maxWidth:"100%",height:"auto"}})}):null,E("receiverSign")&&(0,w.jsx)(l.A,{variant:"outlined",fullWidth:!0,onClick:()=>k("receiverSign"),children:c.receiverSign?"Change Signature":"Add Signature"})]})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(m.A,{fullWidth:!0,type:"date",name:"receiverDate",label:"Receiver Date",InputLabelProps:{shrink:!0},value:c.receiverDate,InputProps:{readOnly:!0}})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,children:(0,w.jsx)(d.A,{variant:"h6",sx:{mb:2,mt:2},children:"Inspector Details"})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(m.A,{fullWidth:!0,name:"inspectorName",label:"Inspector Name",value:c.inspectorName,onChange:W,disabled:!E("inspectorName")})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsxs)(s.A,{sx:{width:"100%",mt:-3},children:[(0,w.jsx)(d.A,{variant:"subtitle2",sx:{marginBottom:"3px !important"},children:"Inspector Signature"}),c.inspectorSign?(0,w.jsx)(s.A,{sx:{border:"1px solid #ccc",p:1,mb:1},children:(0,w.jsx)("img",{src:c.inspectorSign,alt:"Inspector Signature",style:{maxWidth:"100%",height:"auto"}})}):null,E("inspectorSign")&&(0,w.jsx)(l.A,{variant:"outlined",fullWidth:!0,onClick:()=>k("inspectorSign"),children:c.inspectorSign?"Change Signature":"Add Signature"})]})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(m.A,{fullWidth:!0,type:"date",name:"inspectorDate",label:"Inspector Date",InputLabelProps:{shrink:!0},value:c.inspectorDate,InputProps:{readOnly:!0}})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,children:(0,w.jsx)(d.A,{variant:"h6",sx:{mb:2,mt:2},children:"Approver Details"})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(m.A,{fullWidth:!0,name:"approverName",label:"Approver Name",value:c.approverName,onChange:W,disabled:!E("approverName")})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsxs)(s.A,{sx:{width:"100%",mt:-3},children:[(0,w.jsx)(d.A,{variant:"subtitle2",sx:{marginBottom:"3px !important"},children:"Approver Signature"}),c.approverSign?(0,w.jsx)(s.A,{sx:{border:"1px solid #ccc",p:1,mb:1},children:(0,w.jsx)("img",{src:c.approverSign,alt:"Approver Signature",style:{maxWidth:"100%",height:"auto"}})}):null,E("approverSign")&&(0,w.jsx)(l.A,{variant:"outlined",fullWidth:!0,onClick:()=>k("approverSign"),children:c.approverSign?"Change Signature":"Add Signature"})]})}),(0,w.jsx)(p.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(m.A,{fullWidth:!0,type:"date",name:"approverDate",label:"Approver Date",InputLabelProps:{shrink:!0},value:c.approverDate,InputProps:{readOnly:!0}})}),(0,w.jsxs)(p.Ay,{item:!0,xs:12,children:[(0,w.jsx)(d.A,{variant:"h6",sx:{mb:2,mt:2},children:"Attachment (Optional - Max 1MB)"}),(0,w.jsx)(v.A,{type:"file",accept:"application/pdf",onChange:t=>{const e=t.target.files[0];if(e){if("application/pdf"!==e.type)return alert("Please upload only PDF files"),void(t.target.value="");if(e.size>1048576)return alert("File size should be less than 1MB"),void(t.target.value="");const n=new FileReader;n.onload=()=>{_((t=>({...t,attachmentUrl:n.result,attachmentName:e.name})))},n.readAsDataURL(e)}},sx:{mb:2}}),c.attachmentUrl&&(0,w.jsxs)(d.A,{variant:"body2",color:"primary",sx:{mt:1},children:["Current attachment: ",c.attachmentName||"PDF Document"]})]}),(0,w.jsx)(A,{open:b,onClose:()=>S(!1),onSave:t=>{const e=(new Date).toISOString().split("T")[0],n=D.replace("Sign","Date");_((i=>({...i,[D]:t,[n]:e}))),S(!1),P(null)},title:`Add ${null===D||void 0===D?void 0:D.replace("Sign","")} Signature`}),(0,w.jsx)(p.Ay,{item:!0,xs:12,children:(0,w.jsx)(s.A,{sx:{display:"flex",gap:2,mt:2},children:(0,w.jsx)(l.A,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0,children:"Submit Form"})})})]})})]})})}},1497:(t,e,n)=>{"use strict";var i=n(3218);function r(){}function o(){}o.resetWarningCache=r,t.exports=function(){function t(t,e,n,r,o,a){if(a!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:o,resetWarningCache:r};return n.PropTypes=n,n}},2576:function(t){t.exports=function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";function n(t){var e=t.getContext("2d"),n=t.width,i=t.height,r=e.getImageData(0,0,n,i).data,s=o(!0,n,i,r),c=o(!1,n,i,r),l=a(!0,n,i,r),h=a(!1,n,i,r)-l+1,u=c-s+1,d=e.getImageData(l,s,h,u);return t.width=h,t.height=u,e.clearRect(0,0,h,u),e.putImageData(d,0,0),t}function i(t,e,n,i){return{red:i[4*(n*e+t)],green:i[4*(n*e+t)+1],blue:i[4*(n*e+t)+2],alpha:i[4*(n*e+t)+3]}}function r(t,e,n,r){return i(t,e,n,r).alpha}function o(t,e,n,i){for(var o=t?1:-1,a=t?0:n-1;t?a<n:a>-1;a+=o)for(var s=0;s<e;s++)if(r(s,a,e,i))return a;return null}function a(t,e,n,i){for(var o=t?1:-1,a=t?0:e-1;t?a<e:a>-1;a+=o)for(var s=0;s<n;s++)if(r(a,s,e,i))return a;return null}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n}])},3218:t=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},5173:(t,e,n)=>{t.exports=n(1497)()},5496:function(t,e,n){var i,r,o,a;t.exports=(i=n(5173),r=n(5043),o=n(6363),a=n(2576),function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n={};for(var i in t)e.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=i(n(1)),u=n(2),d=i(u),p=i(n(3)),m=i(n(4)),v=function(t){function e(){var t,n,i;o(this,e);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return n=i=a(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(c))),i._sigPad=null,i._excludeOurProps=function(){var t=i.props;return t.canvasProps,t.clearOnResize,r(t,["canvasProps","clearOnResize"])},i.getCanvas=function(){return i._canvas},i.getTrimmedCanvas=function(){var t=document.createElement("canvas");return t.width=i._canvas.width,t.height=i._canvas.height,t.getContext("2d").drawImage(i._canvas,0,0),(0,m.default)(t)},i.getSignaturePad=function(){return i._sigPad},i._checkClearOnResize=function(){i.props.clearOnResize&&i._resizeCanvas()},i._resizeCanvas=function(){var t=i.props.canvasProps||{},e=t.width,n=t.height;if(!e||!n){var r=i._canvas,o=Math.max(window.devicePixelRatio||1,1);e||(r.width=r.offsetWidth*o),n||(r.height=r.offsetHeight*o),r.getContext("2d").scale(o,o),i.clear()}},i.on=function(){return window.addEventListener("resize",i._checkClearOnResize),i._sigPad.on()},i.off=function(){return window.removeEventListener("resize",i._checkClearOnResize),i._sigPad.off()},i.clear=function(){return i._sigPad.clear()},i.isEmpty=function(){return i._sigPad.isEmpty()},i.fromDataURL=function(t,e){return i._sigPad.fromDataURL(t,e)},i.toDataURL=function(t,e){return i._sigPad.toDataURL(t,e)},i.fromData=function(t){return i._sigPad.fromData(t)},i.toData=function(){return i._sigPad.toData()},a(i,n)}return s(e,t),l(e,[{key:"componentDidMount",value:function(){this._sigPad=new p.default(this._canvas,this._excludeOurProps()),this._resizeCanvas(),this.on()}},{key:"componentWillUnmount",value:function(){this.off()}},{key:"componentDidUpdate",value:function(){Object.assign(this._sigPad,this._excludeOurProps())}},{key:"render",value:function(){var t=this,e=this.props.canvasProps;return d.default.createElement("canvas",c({ref:function(e){t._canvas=e}},e))}}]),e}(u.Component);v.propTypes={velocityFilterWeight:h.default.number,minWidth:h.default.number,maxWidth:h.default.number,minDistance:h.default.number,dotSize:h.default.oneOfType([h.default.number,h.default.func]),penColor:h.default.string,throttle:h.default.number,onEnd:h.default.func,onBegin:h.default.func,canvasProps:h.default.object,clearOnResize:h.default.bool},v.defaultProps={clearOnResize:!0},e.default=v},function(t,e){t.exports=i},function(t,e){t.exports=r},function(t,e){t.exports=o},function(t,e){t.exports=a}]))},6363:(t,e,n)=>{"use strict";function i(t,e,n){this.x=t,this.y=e,this.time=n||(new Date).getTime()}function r(t,e,n,i){this.startPoint=t,this.control1=e,this.control2=n,this.endPoint=i}function o(t,e){var n=this,i=e||{};this.velocityFilterWeight=i.velocityFilterWeight||.7,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||2.5,this.throttle="throttle"in i?i.throttle:16,this.minDistance="minDistance"in i?i.minDistance:5,this.throttle?this._strokeMoveUpdate=function(t,e,n){var i,r,o,a=null,s=0;n||(n={});var c=function(){s=!1===n.leading?0:Date.now(),a=null,o=t.apply(i,r),a||(i=r=null)};return function(){var l=Date.now();s||!1!==n.leading||(s=l);var h=e-(l-s);return i=this,r=arguments,h<=0||h>e?(a&&(clearTimeout(a),a=null),s=l,o=t.apply(i,r),a||(i=r=null)):a||!1===n.trailing||(a=setTimeout(c,h)),o}}(o.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=o.prototype._strokeUpdate,this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=i.penColor||"black",this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this.onBegin=i.onBegin,this.onEnd=i.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(n._mouseButtonDown=!0,n._strokeBegin(t))},this._handleMouseMove=function(t){n._mouseButtonDown&&n._strokeMoveUpdate(t)},this._handleMouseUp=function(t){1===t.which&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(t))},this._handleTouchStart=function(t){if(1===t.targetTouches.length){var e=t.changedTouches[0];n._strokeBegin(e)}},this._handleTouchMove=function(t){t.preventDefault();var e=t.targetTouches[0];n._strokeMoveUpdate(e)},this._handleTouchEnd=function(t){t.target===n._canvas&&(t.preventDefault(),n._strokeEnd(t))},this.on()}n.r(e),n.d(e,{default:()=>a}),i.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},i.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},i.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},r.prototype.length=function(){for(var t=0,e=void 0,n=void 0,i=0;i<=10;i+=1){var r=i/10,o=this._point(r,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),a=this._point(r,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(i>0){var s=o-e,c=a-n;t+=Math.sqrt(s*s+c*c)}e=o,n=a}return t},r.prototype._point=function(t,e,n,i,r){return e*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*i*(1-t)*t*t+r*t*t*t},o.prototype.clear=function(){var t=this._ctx,e=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(),this._isEmpty=!0},o.prototype.fromDataURL=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new Image,r=n.ratio||window.devicePixelRatio||1,o=n.width||this._canvas.width/r,a=n.height||this._canvas.height/r;this._reset(),i.src=t,i.onload=function(){e._ctx.drawImage(i,0,0,o,a)},this._isEmpty=!1},o.prototype.toDataURL=function(t){var e;if("image/svg+xml"===t)return this._toSVG();for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return(e=this._canvas).toDataURL.apply(e,[t].concat(i))},o.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},o.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},o.prototype.isEmpty=function(){return this._isEmpty},o.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),"function"===typeof this.onBegin&&this.onBegin(t)},o.prototype._strokeUpdate=function(t){var e=t.clientX,n=t.clientY,i=this._createPoint(e,n),r=this._data[this._data.length-1],o=r&&r[r.length-1],a=o&&i.distanceTo(o)<this.minDistance;if(!o||!a){var s=this._addPoint(i),c=s.curve,l=s.widths;c&&l&&this._drawCurve(c,l.start,l.end),this._data[this._data.length-1].push({x:i.x,y:i.y,time:i.time,color:this.penColor})}},o.prototype._strokeEnd=function(t){var e=this.points.length>2,n=this.points[0];if(!e&&n&&this._drawDot(n),n){var i=this._data[this._data.length-1],r=i[i.length-1];n.equals(r)||i.push({x:n.x,y:n.y,time:n.time,color:this.penColor})}"function"===typeof this.onEnd&&this.onEnd(t)},o.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},o.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},o.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},o.prototype._createPoint=function(t,e,n){var r=this._canvas.getBoundingClientRect();return new i(t-r.left,e-r.top,n||(new Date).getTime())},o.prototype._addPoint=function(t){var e=this.points;if(e.push(t),e.length>2){3===e.length&&e.unshift(e[0]);var n=this._calculateCurveControlPoints(e[0],e[1],e[2]).c2,i=this._calculateCurveControlPoints(e[1],e[2],e[3]).c1,o=new r(e[1],n,i,e[2]),a=this._calculateCurveWidths(o);return e.shift(),{curve:o,widths:a}}return{}},o.prototype._calculateCurveControlPoints=function(t,e,n){var r=t.x-e.x,o=t.y-e.y,a=e.x-n.x,s=e.y-n.y,c=(t.x+e.x)/2,l=(t.y+e.y)/2,h=(e.x+n.x)/2,u=(e.y+n.y)/2,d=Math.sqrt(r*r+o*o),p=Math.sqrt(a*a+s*s),m=p/(d+p),v=h+(c-h)*m,f=u+(l-u)*m,x=e.x-v,g=e.y-f;return{c1:new i(c+x,l+g),c2:new i(h+x,u+g)}},o.prototype._calculateCurveWidths=function(t){var e=t.startPoint,n=t.endPoint,i={start:null,end:null},r=this.velocityFilterWeight*n.velocityFrom(e)+(1-this.velocityFilterWeight)*this._lastVelocity,o=this._strokeWidth(r);return i.start=this._lastWidth,i.end=o,this._lastVelocity=r,this._lastWidth=o,i},o.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)},o.prototype._drawPoint=function(t,e,n){var i=this._ctx;i.moveTo(t,e),i.arc(t,e,n,0,2*Math.PI,!1),this._isEmpty=!1},o.prototype._drawCurve=function(t,e,n){var i=this._ctx,r=n-e,o=Math.floor(t.length());i.beginPath();for(var a=0;a<o;a+=1){var s=a/o,c=s*s,l=c*s,h=1-s,u=h*h,d=u*h,p=d*t.startPoint.x;p+=3*u*s*t.control1.x,p+=3*h*c*t.control2.x,p+=l*t.endPoint.x;var m=d*t.startPoint.y;m+=3*u*s*t.control1.y,m+=3*h*c*t.control2.y,m+=l*t.endPoint.y;var v=e+l*r;this._drawPoint(p,m,v)}i.closePath(),i.fill()},o.prototype._drawDot=function(t){var e=this._ctx,n="function"===typeof this.dotSize?this.dotSize():this.dotSize;e.beginPath(),this._drawPoint(t.x,t.y,n),e.closePath(),e.fill()},o.prototype._fromData=function(t,e,n){for(var r=0;r<t.length;r+=1){var o=t[r];if(o.length>1)for(var a=0;a<o.length;a+=1){var s=o[a],c=new i(s.x,s.y,s.time),l=s.color;if(0===a)this.penColor=l,this._reset(),this._addPoint(c);else if(a!==o.length-1){var h=this._addPoint(c),u=h.curve,d=h.widths;u&&d&&e(u,d,l)}}else this._reset(),n(o[0])}},o.prototype._toSVG=function(){var t=this,e=this._data,n=this._canvas,i=Math.max(window.devicePixelRatio||1,1),r=n.width/i,o=n.height/i,a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"width",n.width),a.setAttributeNS(null,"height",n.height),this._fromData(e,(function(t,e,n){var i=document.createElement("path");if(!isNaN(t.control1.x)&&!isNaN(t.control1.y)&&!isNaN(t.control2.x)&&!isNaN(t.control2.y)){var r="M "+t.startPoint.x.toFixed(3)+","+t.startPoint.y.toFixed(3)+" C "+t.control1.x.toFixed(3)+","+t.control1.y.toFixed(3)+" "+t.control2.x.toFixed(3)+","+t.control2.y.toFixed(3)+" "+t.endPoint.x.toFixed(3)+","+t.endPoint.y.toFixed(3);i.setAttribute("d",r),i.setAttribute("stroke-width",(2.25*e.end).toFixed(3)),i.setAttribute("stroke",n),i.setAttribute("fill","none"),i.setAttribute("stroke-linecap","round"),a.appendChild(i)}}),(function(e){var n=document.createElement("circle"),i="function"===typeof t.dotSize?t.dotSize():t.dotSize;n.setAttribute("r",i),n.setAttribute("cx",e.x),n.setAttribute("cy",e.y),n.setAttribute("fill",e.color),a.appendChild(n)}));var s='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+r+" "+o+'" width="'+r+'" height="'+o+'">',c=a.innerHTML;if(void 0===c){var l=document.createElement("dummy"),h=a.childNodes;l.innerHTML="";for(var u=0;u<h.length;u+=1)l.appendChild(h[u].cloneNode(!0));c=l.innerHTML}return"data:image/svg+xml;base64,"+btoa(s+c+"</svg>")},o.prototype.fromData=function(t){var e=this;this.clear(),this._fromData(t,(function(t,n){return e._drawCurve(t,n.start,n.end)}),(function(t){return e._drawDot(t)})),this._data=t},o.prototype.toData=function(){return this._data};const a=o}}]);
//# sourceMappingURL=573.daa4136c.chunk.js.map