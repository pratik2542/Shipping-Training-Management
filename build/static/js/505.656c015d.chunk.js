"use strict";(self.webpackChunkddrops=self.webpackChunkddrops||[]).push([[505],{9505:(e,t,s)=>{s.r(t),s.d(t,{default:()=>_});var r=s(5043),a=s(3336),n=s(6446),i=s(5865),o=s(1906),l=s(8076),c=s(2420),d=s(35),x=s(6600),m=s(5316),u=s(5721),p=s(1322),h=s(9336),j=s(9347),A=s(5795),f=s(1637),y=s(9252),g=s(4669),v=s(4056),b=s(1787),w=s(9650),S=s(1806),C=s(4882),k=s(3460),I=s(5472),W=s(6822),z=s(3216),D=s(6360),E=s(2177),B=s(7402),T=s(9423),P=s(9778),R=s(5502),N=s(8082),O=s(3639),q=s(6240),U=s(344),L=s(8452);L.Ay.init("P_vvkj76LJzEvipCY");const J="service_1pw3job",$="template_d7h6i4d",G=async(e,t,s)=>{try{if(!L.Ay.send)throw console.error("EmailJS send function not available"),new Error("Email service not properly initialized");return await L.Ay.send(e,t,s)}catch(r){throw console.error("Error in emailjs.send:",r),r}};var M=s(579);const _=()=>{const[e,t]=(0,r.useState)([]),[s,L]=(0,r.useState)([]),[_,F]=(0,r.useState)(0),[K,V]=(0,r.useState)(""),[Z,H]=(0,r.useState)(null),[Y,Q]=(0,r.useState)(!1),[X,ee]=(0,r.useState)(!1),[te,se]=(0,r.useState)(!1),[re,ae]=(0,r.useState)(""),[ne,ie]=(0,r.useState)(null),oe=(0,z.Zp)(),le=(0,q.A)(),ce=(0,U.A)(le.breakpoints.down("md"));(0,r.useEffect)((()=>{"true"===localStorage.getItem("isAdmin")?de():oe("/dashboard")}),[oe]),(0,r.useEffect)((()=>{const t=e.filter((e=>{var t,s;const r=!K||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(K.toLowerCase()))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(K.toLowerCase())),a=0===_&&"pending"===e.status||1===_&&"approved"===e.status||2===_&&"rejected"===e.status;return r&&a}));L(t)}),[e,K,_]);const de=async()=>{try{const e=(0,I.P)((0,I.rJ)(W.db,"userRequests"),(0,I.My)("createdAt","desc")),s=(await(0,I.GG)(e)).docs.map((e=>({id:e.id,...e.data()})));t(s),console.log("Requests loaded:",s.length)}catch(e){console.error("Error fetching requests:",e),alert("Error loading user requests")}},xe=e=>{ie(e),ae(""),ee(!0)},me=async(e,t)=>{try{const r=(0,I.H9)(W.db,"userRequests",e.id);if("approve"===t)try{const t="tempPassword123",a=`https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=${{apiKey:"AIzaSyBLAlnwwRasaBO88OsM8GsJ0os-8bwAT08"}.apiKey}`,n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:t,returnSecureToken:!1})};try{await fetch(a,n),console.log("User created successfully")}catch(s){console.log("User might already exist, continuing with approval")}await(async(e,t)=>{try{const s=e.name||e.email.split("@")[0],r={to_email:e.email,to_name:s,message:t,subject:"Your Account Has Been Approved"};console.log("Sending approval email to:",e.email);const a=await G(J,$,r);return console.log("Approval email sent successfully:",a),a}catch(s){return console.error("Failed to send approval email:",s),alert(`Note: Email could not be sent to ${e.email}. Please inform the user manually.`),{status:"Email failed but continuing with approval"}}})(e,t),await(0,I.mZ)(r,{status:"approved",approvedAt:(new Date).toISOString()}),de(),alert(`User ${e.email} approved and welcome email sent.`)}catch(s){throw console.error("Error during user approval:",s),s}else"reject"===t&&(await(0,I.mZ)(r,{status:"rejected",rejectedAt:(new Date).toISOString()}),de(),alert(`User ${e.email} rejected.`))}catch(s){console.error("Error updating user status:",s),alert(`Error: ${s.message}`)}},ue=e=>{H(e),Q(!0)},pe=e=>{if(!e)return"N/A";return new Date(e).toLocaleString()},he=()=>(0,M.jsxs)(d.A,{open:Y,onClose:()=>Q(!1),fullWidth:!0,maxWidth:"sm",fullScreen:ce,children:[(0,M.jsx)(x.A,{sx:{fontSize:ce?"1.25rem":"1.5rem",fontWeight:500,borderBottom:"1px solid #eaeaea",pb:2},children:"User Details"}),(0,M.jsx)(m.A,{sx:{mt:2},children:Z&&(0,M.jsxs)(n.A,{sx:{px:ce?0:2},children:[(0,M.jsxs)(u.A,{children:[(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Name"}),(0,M.jsx)(i.A,{variant:"body1",children:Z.name||"No name provided"})]}),(0,M.jsx)(h.A,{}),(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Email"}),(0,M.jsx)(i.A,{variant:"body1",children:Z.email})]}),(0,M.jsx)(h.A,{}),(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Status"}),(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",color:"approved"===Z.status?"success.main":"rejected"===Z.status?"error.main":"warning.main"},children:["approved"===Z.status?(0,M.jsx)(P.A,{sx:{mr:1}}):"rejected"===Z.status?(0,M.jsx)(R.A,{sx:{mr:1}}):(0,M.jsx)(T.A,{sx:{mr:1}}),(0,M.jsx)(i.A,{variant:"body1",sx:{fontWeight:600,textTransform:"capitalize"},children:Z.status})]})]}),(0,M.jsx)(h.A,{}),(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Request Date"}),(0,M.jsx)(i.A,{variant:"body1",children:pe(Z.createdAt)})]}),(0,M.jsx)(h.A,{}),"approved"===Z.status&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Approval Date"}),(0,M.jsx)(i.A,{variant:"body1",children:pe(Z.approvedAt)})]}),(0,M.jsx)(h.A,{})]}),"rejected"===Z.status&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Rejection Date"}),(0,M.jsx)(i.A,{variant:"body1",children:pe(Z.rejectedAt)})]}),(0,M.jsx)(h.A,{})]})]}),"pending"===Z.status&&(0,M.jsxs)(n.A,{sx:{mt:3,display:"flex",justifyContent:"space-between"},children:[(0,M.jsx)(o.A,{variant:"contained",color:"primary",onClick:()=>{Q(!1),xe(Z)},sx:{flex:1,mr:1},children:"Approve User"}),(0,M.jsx)(o.A,{variant:"outlined",color:"error",onClick:()=>{me(Z,"reject"),Q(!1)},sx:{flex:1,ml:1},children:"Reject User"})]})]})}),(0,M.jsx)(j.A,{children:(0,M.jsx)(o.A,{onClick:()=>Q(!1),variant:ce?"contained":"text",fullWidth:ce,children:"Close"})})]}),je=()=>{const[e,t]=(0,r.useState)(""),s=r.useRef(null);r.useEffect((()=>{if(X){t("");const e=setTimeout((()=>{s.current&&s.current.focus()}),50);return()=>clearTimeout(e)}}),[]);const a=()=>{e&&(async e=>{if(ne&&e){se(!0),ae("");try{const s=localStorage.getItem("adminEmail");if(!s)throw new Error("Admin session not found. Please log in again.");const r="AIzaSyBLAlnwwRasaBO88OsM8GsJ0os-8bwAT08";try{const t=`https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=${r}`,a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,password:e,returnSecureToken:!0})},n=await fetch(t,a),i=await n.json();if(i.error)return console.error("Authentication error:",i.error),ae(i.error.message),void se(!1);await me(ne,"approve"),ee(!1)}catch(t){console.error("Authentication error:",t),ae("Authentication failed. Please try again."),se(!1)}}catch(t){console.error("Confirmation error:",t),ae(t.message)}finally{se(!1)}}})(e)};return(0,M.jsxs)(d.A,{open:X,onClose:()=>!te&&ee(!1),maxWidth:"xs",fullWidth:!0,disableEscapeKeyDown:te,children:[(0,M.jsx)(x.A,{sx:{borderBottom:"1px solid #eaeaea",pb:2,fontWeight:500},children:"Confirm Admin Password"}),(0,M.jsxs)(m.A,{sx:{pt:3,pb:1},children:[(0,M.jsx)(i.A,{variant:"body1",sx:{mb:2},children:"Please enter your password to approve:"}),(0,M.jsx)(i.A,{variant:"subtitle1",sx:{mb:3,fontWeight:600},children:null===ne||void 0===ne?void 0:ne.email}),(0,M.jsx)(A.A,{inputRef:s,fullWidth:!0,type:"password",label:"Admin Password",variant:"outlined",value:e,onChange:e=>t(e.target.value),onKeyDown:t=>{"Enter"===t.key&&e&&!te&&(t.preventDefault(),a())},error:!!re,helperText:re,disabled:te,autoComplete:"current-password",sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(25, 118, 210, 0.2)"}}}})]}),(0,M.jsxs)(j.A,{sx:{px:3,py:2},children:[(0,M.jsx)(o.A,{variant:"outlined",onClick:()=>ee(!1),disabled:te,children:"Cancel"}),(0,M.jsx)(o.A,{variant:"contained",color:"primary",onClick:a,disabled:!e||te,sx:{ml:1,minWidth:"100px"},children:te?(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(f.A,{size:20,sx:{mr:1}}),(0,M.jsx)("span",{children:"Verifying"})]}):"Approve"})]})]})};return(0,M.jsxs)(y.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,M.jsxs)(n.A,{sx:{display:"flex",flexDirection:ce?"column":"row",justifyContent:"space-between",alignItems:ce?"stretch":"center",mb:4},children:[(0,M.jsx)(i.A,{variant:"h4",sx:{fontWeight:600,color:"primary.main",mt:2,textAlign:"center",fontSize:ce?"1.75rem":"2.125rem",mb:ce?2:0},children:"User Verification"}),(0,M.jsx)(o.A,{variant:"contained",startIcon:(0,M.jsx)(O.A,{}),onClick:()=>oe("/dashboard"),sx:{alignSelf:ce?"stretch":"flex-end"},children:"Back to Dashboard"})]}),(0,M.jsx)(a.A,{elevation:3,sx:{mb:4},children:(0,M.jsxs)(g.A,{value:_,onChange:(e,t)=>{F(t)},variant:ce?"fullWidth":"standard",sx:{borderBottom:1,borderColor:"divider"},children:[(0,M.jsx)(v.A,{label:"Pending",sx:{py:2}}),(0,M.jsx)(v.A,{label:"Approved",sx:{py:2}}),(0,M.jsx)(v.A,{label:"Rejected",sx:{py:2}})]})}),(0,M.jsx)(A.A,{fullWidth:!0,variant:"outlined",placeholder:"Search by name or email",value:K,onChange:e=>V(e.target.value),sx:{mb:3},InputProps:{startAdornment:(0,M.jsx)(b.A,{position:"start",children:(0,M.jsx)(D.A,{})})}}),ce?(0,M.jsx)(n.A,{children:0===s.length?(0,M.jsxs)(i.A,{align:"center",sx:{my:4,color:"text.secondary"},children:["No ",0===_?"pending":1===_?"approved":"rejected"," requests found"]}):s.map((e=>(0,M.jsxs)(a.A,{elevation:2,sx:{mb:2,p:2,border:"1px solid #eaeaea",backgroundColor:"approved"===e.status?"#f0f7f0":"rejected"===e.status?"#f7f0f0":"white"},children:[(0,M.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,M.jsx)(E.A,{sx:{mr:1,color:"primary.main"}}),(0,M.jsx)(i.A,{variant:"h6",sx:{flexGrow:1},children:e.name||"No Name"})]}),(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(B.A,{sx:{mr:1,fontSize:"1rem",color:"text.secondary"}}),(0,M.jsx)(i.A,{variant:"body2",color:"text.secondary",children:e.email})]}),(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(T.A,{sx:{mr:1,fontSize:"1rem",color:"text.secondary"}}),(0,M.jsx)(i.A,{variant:"body2",color:"text.secondary",children:pe(e.createdAt)})]}),(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",color:"approved"===e.status?"success.main":"rejected"===e.status?"error.main":"warning.main",mt:1},children:["approved"===e.status?(0,M.jsx)(P.A,{sx:{mr:1,fontSize:"1.2rem"}}):"rejected"===e.status?(0,M.jsx)(R.A,{sx:{mr:1,fontSize:"1.2rem"}}):(0,M.jsx)(T.A,{sx:{mr:1,fontSize:"1.2rem"}}),(0,M.jsx)(i.A,{variant:"body1",sx:{fontWeight:600,textTransform:"capitalize"},children:e.status})]})]}),"pending"===e.status&&(0,M.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",mt:2,pt:2,borderTop:"1px solid #eaeaea"},children:[(0,M.jsx)(o.A,{variant:"contained",color:"primary",size:"small",sx:{flex:1,mr:1},onClick:()=>xe(e),children:"Approve"}),(0,M.jsx)(o.A,{variant:"outlined",color:"error",size:"small",sx:{flex:1,ml:1},onClick:()=>me(e,"reject"),children:"Reject"})]}),(0,M.jsx)(o.A,{variant:"text",fullWidth:!0,onClick:()=>ue(e),sx:{mt:1},endIcon:(0,M.jsx)(N.A,{}),children:"View Details"})]},e.id)))}):(0,M.jsx)(w.A,{component:a.A,children:(0,M.jsxs)(S.A,{children:[(0,M.jsx)(C.A,{children:(0,M.jsxs)(l.A,{sx:{backgroundColor:"primary.main"},children:[(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Name"}),(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Email"}),(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Request Date"}),(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Status"}),(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Actions"})]})}),(0,M.jsx)(k.A,{children:0===s.length?(0,M.jsx)(l.A,{children:(0,M.jsxs)(c.A,{colSpan:5,align:"center",sx:{py:3},children:["No ",0===_?"pending":1===_?"approved":"rejected"," requests found"]})}):s.map((e=>(0,M.jsxs)(l.A,{sx:{backgroundColor:"approved"===e.status?"#f0f7f0":"rejected"===e.status?"#f7f0f0":"white","&:hover":{backgroundColor:"action.hover"}},children:[(0,M.jsx)(c.A,{children:e.name||"No Name"}),(0,M.jsx)(c.A,{children:e.email}),(0,M.jsx)(c.A,{children:pe(e.createdAt)}),(0,M.jsx)(c.A,{children:(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",color:"approved"===e.status?"success.main":"rejected"===e.status?"error.main":"warning.main"},children:["approved"===e.status?(0,M.jsx)(P.A,{sx:{mr:1,fontSize:"small"}}):"rejected"===e.status?(0,M.jsx)(R.A,{sx:{mr:1,fontSize:"small"}}):(0,M.jsx)(T.A,{sx:{mr:1,fontSize:"small"}}),(0,M.jsx)(i.A,{sx:{fontWeight:500,textTransform:"capitalize"},children:e.status})]})}),(0,M.jsxs)(c.A,{children:["pending"===e.status&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(o.A,{variant:"contained",color:"primary",size:"small",sx:{mr:1},onClick:()=>xe(e),children:"Approve"}),(0,M.jsx)(o.A,{variant:"outlined",color:"error",size:"small",onClick:()=>me(e,"reject"),children:"Reject"})]}),(0,M.jsx)(o.A,{variant:"text",size:"small",sx:{ml:1},onClick:()=>ue(e),children:"Details"})]})]},e.id)))})]})}),(0,M.jsx)(he,{}),(0,M.jsx)(je,{})]})}}}]);
//# sourceMappingURL=505.656c015d.chunk.js.map