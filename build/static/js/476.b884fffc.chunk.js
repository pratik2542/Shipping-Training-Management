"use strict";(self.webpackChunkddrops=self.webpackChunkddrops||[]).push([[476],{6476:(e,t,r)=>{r.r(t),r.d(t,{default:()=>_});var s=r(5043),a=r(7872),i=r(6446),o=r(5865),n=r(1906),c=r(3336),l=r(1806),d=r(4882),m=r(8076),u=r(2420),h=r(3460),p=r(5472),w=r(6822),g=r(3216),y=r(3639),j=r(1702),b=r(8797);class f{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Network Error";this.status=e,this.text=t}}const v={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:(()=>{if("undefined"!==typeof localStorage)return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}})()},x=e=>e?"string"===typeof e?{publicKey:e}:"[object Object]"===e.toString()?e:{}:{},A=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=await fetch(v.origin+e,{method:"POST",headers:r,body:t}),a=await s.text(),i=new f(s.status,a);if(s.ok)return i;throw i},S=(e,t,r)=>{if(!e||"string"!==typeof e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||"string"!==typeof t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||"string"!==typeof r)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},k=e=>e.webdriver||!e.languages||0===e.languages.length,E=()=>new f(451,"Unavailable For Headless Browser"),I=(e,t)=>{if((e=>!e.list?.length||!e.watchVariable)(e))return!1;((e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if("string"!==typeof t)throw"The BlockList watchVariable has to be a string"})(e.list,e.watchVariable);const r=(s=t,a=e.watchVariable,s instanceof FormData?s.get(a):s[a]);var s,a;return"string"===typeof r&&e.list.includes(r)},C=()=>new f(403,"Forbidden"),P=async(e,t,r)=>{if(!t.throttle||!r)return!1;((e,t)=>{if("number"!==typeof e||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&"string"!==typeof t)throw"The LimitRate ID has to be a non-empty string"})(t.throttle,t.id);const s=t.id||e,a=await(async(e,t,r)=>{const s=Number(await r.get(e)||0);return t-Date.now()+s})(s,t.throttle,r);return a>0||(await r.set(s,Date.now().toString()),!1)},D=()=>new f(429,"Too Many Requests"),R=async(e,t,r,s)=>{const a=x(s),i=a.publicKey||v.publicKey,o=a.blockHeadless||v.blockHeadless,n=a.storageProvider||v.storageProvider,c={...v.blockList,...a.blockList},l={...v.limitRate,...a.limitRate};if(o&&k(navigator))return Promise.reject(E());if(S(i,e,t),(e=>{if(e&&"[object Object]"!==e.toString())throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"})(r),r&&I(c,r))return Promise.reject(C());if(await P(location.pathname,l,n))return Promise.reject(D());const d={lib_version:"4.4.1",user_id:i,service_id:e,template_id:t,template_params:r};return A("/api/v1.0/email/send",JSON.stringify(d),{"Content-type":"application/json"})},q=async e=>{let{to:t,name:r,subject:s,html:a}=e;try{const e={to_email:t,to_name:r,subject:s,message:a},i=await R("service_1pw3job","template_d7h6i4d",e,"P_vvkj76LJzEvipCY");return console.log("Email sent successfully:",i),i}catch(i){throw console.error("Error sending email:",i),new Error("Error sending email")}};var T=r(579);const _=()=>{const e=(0,g.Zp)(),[t,r]=(0,s.useState)([]);(0,s.useEffect)((()=>{f()}),[]);const f=async()=>{try{const e=(await(0,p.GG)((0,p.rJ)(w.db,"userRequests"))).docs.map((e=>({...e.data(),id:e.id}))).filter((e=>"pending"===e.status));r(e)}catch(e){console.error("Error fetching pending users:",e)}};return(0,T.jsxs)(a.A,{maxWidth:"lg",children:[(0,T.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,mt:4},children:[(0,T.jsx)(o.A,{variant:"h4",sx:{mt:2},children:"User Verification Requests"}),(0,T.jsxs)(i.A,{children:[(0,T.jsx)(n.A,{variant:"contained",startIcon:(0,T.jsx)(y.A,{}),onClick:()=>e("/dashboard"),sx:{mr:2,mt:2},children:"Dashboard"}),(0,T.jsx)(n.A,{variant:"outlined",startIcon:(0,T.jsx)(j.A,{}),onClick:async()=>{try{await(0,b.CI)(w.j),localStorage.removeItem("isAdmin"),e("/")}catch(t){console.error("Error during logout:",t),e("/")}},sx:{mt:2},children:"Logout"})]})]}),(0,T.jsx)(c.A,{elevation:3,sx:{p:4},children:(0,T.jsxs)(l.A,{children:[(0,T.jsx)(d.A,{children:(0,T.jsxs)(m.A,{children:[(0,T.jsx)(u.A,{children:"Name"}),(0,T.jsx)(u.A,{children:"Email"}),(0,T.jsx)(u.A,{children:"Date Requested"}),(0,T.jsx)(u.A,{children:"Actions"})]})}),(0,T.jsx)(h.A,{children:t.map((e=>(0,T.jsxs)(m.A,{children:[(0,T.jsx)(u.A,{children:e.name}),(0,T.jsx)(u.A,{children:e.email}),(0,T.jsx)(u.A,{children:new Date(e.createdAt).toLocaleDateString()}),(0,T.jsx)(u.A,{children:(0,T.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,T.jsx)(n.A,{variant:"contained",color:"success",onClick:()=>(async e=>{try{const r=w.j.currentUser.email,s=await new Promise((e=>{const t=document.createElement("input");t.type="password",t.placeholder="Enter admin password";const r=document.createElement("div");r.style.position="fixed",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.backgroundColor="white",r.style.padding="20px",r.style.boxShadow="0 0 10px rgba(0,0,0,0.5)",r.style.zIndex="1000",r.appendChild(t);const s=document.createElement("button");s.textContent="Submit",s.onclick=()=>{r.remove(),e(t.value)},r.appendChild(s),document.body.appendChild(r),t.focus()})),a=localStorage.getItem("isAdmin");try{await(0,b.x9)(w.j,r,s),localStorage.setItem("isAdmin",a)}catch(t){return void alert("Invalid admin password. Approval cancelled.")}const i=(0,b.xI)(),o="tempPassword123";try{const t=await(0,b.eJ)(i,e.email,o);await q({to:e.email,name:e.name,subject:"Account Approved - Temporary Password",html:o}),await(0,p.BN)((0,p.H9)(w.db,"usersData",t.user.uid),{uid:t.user.uid,name:e.name,email:e.email,createdAt:(new Date).toISOString(),isTestUser:!1}),await(0,p.mZ)((0,p.H9)(w.db,"userRequests",e.id),{status:"approved",uid:t.user.uid,verificationSent:!0,verificationSentAt:(new Date).toISOString()}),await(0,b.x9)(w.j,r,s),localStorage.setItem("isAdmin","true"),alert("User approved successfully. Email with temporary password sent."),f()}catch(t){throw await(0,b.x9)(w.j,r,s),localStorage.setItem("isAdmin","true"),t}}catch(t){console.error("Error in approval process:",t),alert(`Error approving user: ${t.message}`)}})(e),children:"Approve"}),(0,T.jsx)(n.A,{variant:"contained",color:"error",onClick:()=>(async e=>{if(window.confirm(`Are you sure you want to reject ${e.name}'s registration request?`))try{const s=w.j.currentUser.email,a=await new Promise((e=>{const t=document.createElement("input");t.type="password",t.placeholder="Enter admin password";const r=document.createElement("div");r.style.position="fixed",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.backgroundColor="white",r.style.padding="20px",r.style.boxShadow="0 0 10px rgba(0,0,0,0.5)",r.style.zIndex="1000",r.appendChild(t);const s=document.createElement("button");s.textContent="Submit",s.onclick=()=>{r.remove(),e(t.value)},r.appendChild(s),document.body.appendChild(r),t.focus()}));try{await(0,b.x9)(w.j,s,a)}catch(t){return void alert("Invalid admin password. Rejection cancelled.")}await(0,p.mZ)((0,p.H9)(w.db,"userRequests",e.id),{status:"rejected",rejectedAt:(new Date).toISOString(),rejectedBy:s});try{await q({to:e.email,name:e.name,subject:"Registration Request Status",html:"Your registration request has been declined."})}catch(r){console.error("Error sending rejection email:",r)}alert("User registration rejected successfully."),f()}catch(t){console.error("Error rejecting user:",t),alert(`Error rejecting user: ${t.message}`)}})(e),children:"Reject"})]})})]},e.id)))})]})})]})}}}]);
//# sourceMappingURL=476.b884fffc.chunk.js.map