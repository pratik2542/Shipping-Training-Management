"use strict";(self.webpackChunkddrops=self.webpackChunkddrops||[]).push([[425],{8425:(e,r,t)=>{t.r(r),t.d(r,{default:()=>P});var n=t(5043),s=t(8076),i=t(2420),o=t(5865),c=t(7392),a=t(35),l=t(6600),d=t(5316),h=t(1806),x=t(3460),p=t(1906),m=t(9347),j=t(7872),A=t(6446),g=t(7424),u=t(1787),v=t(9650),S=t(3336),w=t(4882),I=t(5472),N=t(6822),b=t(3612),f=t(6360),y=t(3159),D=t(7260),C=t(3216),k=t(3044),U=t(7762);var R=t(3639),W=t(1702),F=t(9786),L=t(3471),E=t(579);const P=()=>{const e=(0,C.Zp)(),[r,t]=(0,n.useState)([]),[P,T]=(0,n.useState)(""),[z,G]=(0,n.useState)(!1),[_,$]=(0,n.useState)(null),[B]=(0,n.useState)("true"===localStorage.getItem("isAdmin"));(0,n.useEffect)((()=>{O()}),[]);const O=async()=>{try{const e="true"===localStorage.getItem("isTestUser"),r=e?b.B:N.db,n=e?"test_shipments":"shipments";if(e){const e=(await(0,I.GG)((0,I.rJ)(r,n))).docs.map((e=>({...e.data(),docId:e.id,id:e.data().id})));t(e)}else{const e=(await(0,I.GG)((0,I.rJ)(r,n))).docs.map((e=>({...e.data(),docId:e.id,id:e.data().id})));t(e)}}catch(e){console.error("Error fetching records:",e);"true"===localStorage.getItem("isTestUser")||alert("Error fetching records"),t([])}},J=async e=>{try{const r=await(async e=>{try{const r=new U.Ay;r.setFontSize(20),r.text("Shipping Form",105,15,{align:"center"}),r.setFontSize(12);let t=30;[["DP Number",e.dpNumber],["ID",e.id],["Shipment Date",e.shipmentDate],["Item No",e.itemNo],["Item Name",e.itemName],["Lot Number",e.lotNumber],["Quantities",e.quantities]].forEach((e=>{let[n,s]=e;r.text(`${n}: ${s||""}`,20,t),t+=10}));const n=(e,t,n,s,i)=>(r.setFontSize(14),r.text(e,20,i),r.setFontSize(12),r.text(`Name: ${t||""}`,20,i+10),r.text(`Date: ${n||""}`,20,i+20),s&&r.addImage(s,"PNG",20,i+25,50,25),i+60);return t=n("Receiver Details",e.receiverName,e.receiverDate,e.receiverSign,t+10),t=n("Inspector Details",e.inspectorName,e.inspectorDate,e.inspectorSign,t),t=n("Approver Details",e.approverName,e.approverDate,e.approverSign,t),r.output("arraybuffer")}catch(r){throw console.error("Error generating PDF:",r),new Error("Failed to generate PDF")}})(e),t=new Blob([r],{type:"application/pdf"}),n=URL.createObjectURL(t);window.open(n,"_blank"),setTimeout((()=>URL.revokeObjectURL(n)),1e3)}catch(r){console.error("Error generating PDF:",r),alert("Error generating PDF. Please try again.")}},q=r.filter((e=>{const r=e.shipmentCode||"",t=e.itemName||"",n=P.toLowerCase();return r.toString().toLowerCase().includes(n)||t.toString().toLowerCase().includes(n)})),H=r=>(0,E.jsxs)(s.A,{sx:{"&:hover":{backgroundColor:"action.hover"}},children:[(0,E.jsx)(i.A,{children:r.shipmentCode||"N/A"})," ",(0,E.jsx)(i.A,{children:r.shipmentDate||"N/A"}),(0,E.jsx)(i.A,{children:r.itemName||"N/A"}),(0,E.jsx)(i.A,{children:(0,E.jsx)(o.A,{sx:{color:r.approverSign?"success.main":r.inspectorSign?"info.main":r.receiverSign?"warning.main":"gray",fontWeight:500},children:r.approverSign?"Approved":r.inspectorSign?"Pending Approval":r.receiverSign?"Pending Inspection":"Pending Shipment"})}),(0,E.jsxs)(i.A,{children:[(0,E.jsx)(c.A,{color:"primary",onClick:()=>(r=>{if(r.approverSign)return void alert("Cannot edit an approved record");const t=r.docId;console.log("Editing record with ID:",t),t?e(`/shipping-form?edit=${t}`):alert("Invalid record ID")})(r),disabled:r.approverSign,sx:{mr:1},children:(0,E.jsx)(y.A,{})}),(0,E.jsx)(c.A,{color:"secondary",onClick:()=>(e=>{$(e),G(!0)})(r),sx:{mr:1},children:(0,E.jsx)(D.A,{})}),(0,E.jsx)(c.A,{color:"primary",onClick:()=>J(r),sx:{mr:1},children:(0,E.jsx)(k.A,{})}),B&&(0,E.jsx)(c.A,{color:"error",onClick:()=>(async r=>{if(B&&window.confirm("Are you sure you want to delete this record? This action cannot be undone."))try{const t="true"===localStorage.getItem("isTestUser")?b.B:N.db,n="true"===localStorage.getItem("isTestUser")?"test_shipments":"shipments";await(0,I.kd)((0,I.H9)(t,n,r.docId)),O(),alert("Record deleted successfully"),e("/dashboard")}catch(t){console.error("Error deleting record:",t),alert("Error deleting record")}})(r),sx:{mr:1},title:"Delete Record",children:(0,E.jsx)(L.A,{})})]})]},r.id||r.docId),Q=()=>(0,E.jsxs)(a.A,{open:z,onClose:()=>G(!1),maxWidth:"md",fullWidth:!0,children:[(0,E.jsxs)(l.A,{children:["Shipping Record Details - ",null===_||void 0===_?void 0:_.shipmentCode,"  "]}),(0,E.jsx)(d.A,{children:_&&(0,E.jsx)(h.A,{children:(0,E.jsxs)(x.A,{children:[(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Shipment Code"})}),"  ",(0,E.jsx)(i.A,{children:_.shipmentCode}),"  "]}),(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Shipment Date"})}),(0,E.jsx)(i.A,{children:_.shipmentDate})]}),(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Item Number"})}),(0,E.jsx)(i.A,{children:_.itemNo})]}),(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Item Name"})}),(0,E.jsx)(i.A,{children:_.itemName})]}),(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Lot Number"})}),(0,E.jsx)(i.A,{children:_.lotNumber})]}),(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Quantities"})}),(0,E.jsx)(i.A,{children:_.quantities})]}),_.receiverName&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Receiver Name"})}),(0,E.jsx)(i.A,{children:_.receiverName})]}),(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Receiver Date"})}),(0,E.jsx)(i.A,{children:_.receiverDate})]}),_.receiverSign&&(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Receiver Signature"})}),(0,E.jsx)(i.A,{children:(0,E.jsx)("img",{src:_.receiverSign,alt:"Receiver Signature",style:{maxWidth:"200px"}})})]})]}),_.inspectorName&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Inspector Name"})}),(0,E.jsx)(i.A,{children:_.inspectorName})]}),(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Inspector Date"})}),(0,E.jsx)(i.A,{children:_.inspectorDate})]}),_.inspectorSign&&(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Inspector Signature"})}),(0,E.jsx)(i.A,{children:(0,E.jsx)("img",{src:_.inspectorSign,alt:"Inspector Signature",style:{maxWidth:"200px"}})})]})]}),_.approverName&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Approver Name"})}),(0,E.jsx)(i.A,{children:_.approverName})]}),(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Approver Date"})}),(0,E.jsx)(i.A,{children:_.approverDate})]}),_.approverSign&&(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Approver Signature"})}),(0,E.jsx)(i.A,{children:(0,E.jsx)("img",{src:_.approverSign,alt:"Approver Signature",style:{maxWidth:"200px"}})})]})]}),_.attachmentUrl&&(0,E.jsxs)(s.A,{children:[(0,E.jsx)(i.A,{children:(0,E.jsx)("strong",{children:"Attachment"})}),(0,E.jsx)(i.A,{children:(0,E.jsx)(p.A,{variant:"outlined",size:"small",onClick:()=>{var e;(e=_.attachmentUrl).startsWith("data:application/pdf;base64,")?fetch(e).then((e=>e.blob())).then((e=>{const r=window.URL.createObjectURL(e);window.open(r,"_blank"),window.URL.revokeObjectURL(r)})):window.open(e,"_blank")},children:"View PDF"})})]})]})})}),(0,E.jsx)(m.A,{children:(0,E.jsx)(p.A,{onClick:()=>G(!1),children:"Close"})})]});return(0,E.jsxs)(j.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,E.jsxs)(A.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,E.jsx)(o.A,{variant:"h4",sx:{fontWeight:600,color:"primary.main",mt:2},children:"Shipping Records"}),(0,E.jsxs)(A.A,{children:[(0,E.jsx)(p.A,{variant:"contained",startIcon:(0,E.jsx)(R.A,{}),onClick:()=>e("/dashboard"),sx:{mr:2,mt:2},children:"Home"}),(0,E.jsx)(p.A,{variant:"outlined",color:"primary",startIcon:(0,E.jsx)(W.A,{}),onClick:async()=>{try{"true"===localStorage.getItem("isTestUser")?(await(async()=>{try{const e=(await(0,I.GG)((0,I.rJ)(b.B,"test_shipments"))).docs.map((e=>(0,I.kd)(e.ref)));await Promise.all(e);const r=b.z.currentUser;r&&await r.delete(),console.log("Test data cleanup completed")}catch(e){console.error("Error cleaning up test data:",e)}})(),await(0,F.CI)(b.z)):await(0,F.CI)(N.j),localStorage.removeItem("isTestUser"),e("/")}catch(r){console.error("Error during logout:",r),localStorage.removeItem("isTestUser"),e("/")}},sx:{mt:2},children:"Logout"})]})]}),(0,E.jsx)(g.A,{fullWidth:!0,variant:"outlined",placeholder:"Search by Shipment Code or Item Name",value:P,onChange:e=>T(e.target.value),sx:{mb:3},InputProps:{startAdornment:(0,E.jsx)(u.A,{position:"start",children:(0,E.jsx)(f.A,{})})}}),(0,E.jsx)(v.A,{component:S.A,children:(0,E.jsxs)(h.A,{children:[(0,E.jsx)(w.A,{children:(0,E.jsxs)(s.A,{sx:{backgroundColor:"primary.main"},children:[(0,E.jsx)(i.A,{sx:{color:"white",fontWeight:600},children:"Shipment Code"}),"  ",(0,E.jsx)(i.A,{sx:{color:"white",fontWeight:600},children:"Shipment Date"}),(0,E.jsx)(i.A,{sx:{color:"white",fontWeight:600},children:"Item Name"}),(0,E.jsx)(i.A,{sx:{color:"white",fontWeight:600},children:"Status"}),(0,E.jsx)(i.A,{sx:{color:"white",fontWeight:600},children:"Actions"})]})}),(0,E.jsx)(x.A,{children:q.map((e=>H(e)))})]})}),(0,E.jsx)(Q,{})]})}}}]);
//# sourceMappingURL=425.96bfc399.chunk.js.map