"use strict";(self.webpackChunkddrops=self.webpackChunkddrops||[]).push([[505],{9187:(e,t,r)=>{r.d(t,{A$:()=>i,BE:()=>o,kg:()=>n});var s=r(6822);const a=async(e,t)=>{try{const r=(0,s.CG)();if(!r)throw new Error("API key not available");const a=`https://identitytoolkit.googleapis.com/v1/accounts:${e}?key=${r}`,n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await n.json()}catch(r){throw console.error(`Firebase Auth API error (${e}):`,r),r}},n=(e,t)=>a("signUp",{email:e,password:t,returnSecureToken:!1}),i=e=>a("createAuthUri",{identifier:e,continueUri:window.location.href}),o=(e,t)=>a("signInWithPassword",{email:e,password:t,returnSecureToken:!0})},9505:(e,t,r)=>{r.r(t),r.d(t,{default:()=>V});var s=r(5043),a=r(3336),n=r(6446),i=r(5865),o=r(1906),l=r(8076),c=r(2420),d=r(35),x=r(6600),m=r(5316),u=r(5721),p=r(1322),h=r(9336),j=r(9347),A=r(5795),f=r(1637),v=r(9252),y=r(4669),g=r(4056),b=r(1787),w=r(9650),C=r(1806),S=r(4882),k=r(3460),I=r(5472),D=r(6822),E=r(3216),W=r(6360),z=r(2177),P=r(7402),U=r(9423),B=r(9778),N=r(5502),R=r(8082),T=r(3639),$=r(3471),q=r(6240),L=r(344),F=r(8452);F.Ay.init("P_vvkj76LJzEvipCY");const O="service_1pw3job",_="template_d7h6i4d",G=async(e,t,r)=>{try{if(!F.Ay.send)throw console.error("EmailJS send function not available"),new Error("Email service not properly initialized");return await F.Ay.send(e,t,r)}catch(s){throw console.error("Error in emailjs.send:",s),s}};var J=r(9187),M=r(579);const V=()=>{const[e,t]=(0,s.useState)([]),[r,F]=(0,s.useState)([]),[V,Z]=(0,s.useState)(0),[H,K]=(0,s.useState)(""),[Y,Q]=(0,s.useState)(null),[X,ee]=(0,s.useState)(!1),[te,re]=(0,s.useState)(!1),[se,ae]=(0,s.useState)(!1),[ne,ie]=(0,s.useState)(""),[oe,le]=(0,s.useState)(null),[ce,de]=(0,s.useState)(null),xe=(0,E.Zp)(),me=(0,q.A)(),ue=(0,L.A)(me.breakpoints.down("md"));(0,s.useEffect)((()=>{"true"===localStorage.getItem("isAdmin")?pe():xe("/dashboard")}),[xe]),(0,s.useEffect)((()=>{const t=e.filter((e=>{var t,r;const s=!H||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(H.toLowerCase()))||(null===(r=e.email)||void 0===r?void 0:r.toLowerCase().includes(H.toLowerCase())),a=0===V&&"pending"===e.status||1===V&&"approved"===e.status||2===V&&"rejected"===e.status;return s&&a}));F(t)}),[e,H,V]);const pe=async()=>{try{const e=(0,I.P)((0,I.rJ)(D.db,"userRequests"),(0,I.My)("createdAt","desc")),r=(await(0,I.GG)(e)).docs.map((e=>({id:e.id,...e.data()})));t(r),console.log("Requests loaded:",r.length)}catch(e){console.error("Error fetching requests:",e),alert("Error loading user requests")}},he=(e,t)=>{le(e),de(t||"process"),ie(""),re(!0)},je=async(e,t)=>{try{const s=(0,I.H9)(D.db,"userRequests",e.id);if("approve"===t)try{const t="tempPassword123";try{await(0,J.kg)(e.email,t),console.log("User created successfully")}catch(r){console.log("User might already exist, continuing with approval")}await(async(e,t)=>{try{const r=e.name||e.email.split("@")[0],s={to_email:e.email,to_name:r,message:t,subject:"Your Account Has Been Approved"};console.log("Sending approval email to:",e.email);const a=await G(O,_,s);return console.log("Approval email sent successfully:",a),a}catch(r){return console.error("Failed to send approval email:",r),alert(`Note: Email could not be sent to ${e.email}. Please inform the user manually.`),{status:"Email failed but continuing with approval"}}})(e,t),await(0,I.mZ)(s,{status:"approved",approvedAt:(new Date).toISOString()}),pe(),alert(`User ${e.email} approved and welcome email sent.`)}catch(r){throw console.error("Error during user approval:",r),r}else"reject"===t?(await(0,I.mZ)(s,{status:"rejected",rejectedAt:(new Date).toISOString()}),pe(),alert(`User ${e.email} rejected.`)):"delete"===t&&(await(0,I.kd)(s),pe(),alert(`User ${e.email} deleted.`))}catch(r){console.error(`Error during user ${t}:`,r),alert(`Error: ${r.message}`)}},Ae=e=>{Q(e),ee(!0)},fe=e=>{if(!e)return"N/A";return new Date(e).toLocaleString()},ve=()=>(0,M.jsxs)(d.A,{open:X,onClose:()=>ee(!1),fullWidth:!0,maxWidth:"sm",fullScreen:ue,children:[(0,M.jsx)(x.A,{sx:{fontSize:ue?"1.25rem":"1.5rem",fontWeight:500,borderBottom:"1px solid #eaeaea",pb:2},children:"User Details"}),(0,M.jsx)(m.A,{sx:{mt:2},children:Y&&(0,M.jsxs)(n.A,{sx:{px:ue?0:2},children:[(0,M.jsxs)(u.A,{children:[(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Name"}),(0,M.jsx)(i.A,{variant:"body1",children:Y.name||"No name provided"})]}),(0,M.jsx)(h.A,{}),(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Email"}),(0,M.jsx)(i.A,{variant:"body1",children:Y.email})]}),(0,M.jsx)(h.A,{}),(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Status"}),(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",color:"approved"===Y.status?"success.main":"rejected"===Y.status?"error.main":"warning.main"},children:["approved"===Y.status?(0,M.jsx)(B.A,{sx:{mr:1}}):"rejected"===Y.status?(0,M.jsx)(N.A,{sx:{mr:1}}):(0,M.jsx)(U.A,{sx:{mr:1}}),(0,M.jsx)(i.A,{variant:"body1",sx:{fontWeight:600,textTransform:"capitalize"},children:Y.status})]})]}),(0,M.jsx)(h.A,{}),(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Request Date"}),(0,M.jsx)(i.A,{variant:"body1",children:fe(Y.createdAt)})]}),(0,M.jsx)(h.A,{}),"approved"===Y.status&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Approval Date"}),(0,M.jsx)(i.A,{variant:"body1",children:fe(Y.approvedAt)})]}),(0,M.jsx)(h.A,{})]}),"rejected"===Y.status&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(p.Ay,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,M.jsx)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Rejection Date"}),(0,M.jsx)(i.A,{variant:"body1",children:fe(Y.rejectedAt)})]}),(0,M.jsx)(h.A,{})]})]}),"pending"===Y.status&&(0,M.jsxs)(n.A,{sx:{mt:3,display:"flex",justifyContent:"space-between"},children:[(0,M.jsx)(o.A,{variant:"contained",color:"primary",onClick:()=>{ee(!1),he(Y,"approve")},sx:{flex:1,mr:1},children:"Approve User"}),(0,M.jsx)(o.A,{variant:"outlined",color:"error",onClick:()=>{je(Y,"reject"),ee(!1)},sx:{flex:1,ml:1},children:"Reject User"})]}),(0,M.jsx)(n.A,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,M.jsx)(o.A,{variant:"text",color:"error",startIcon:(0,M.jsx)($.A,{}),onClick:()=>{ee(!1),he(Y,"delete")},children:"Delete User"})})]})}),(0,M.jsx)(j.A,{children:(0,M.jsx)(o.A,{onClick:()=>ee(!1),variant:ue?"contained":"text",fullWidth:ue,children:"Close"})})]}),ye=()=>{const[e,t]=(0,s.useState)(""),r=s.useRef(null);s.useEffect((()=>{if(te){t("");const e=setTimeout((()=>{r.current&&r.current.focus()}),50);return()=>clearTimeout(e)}}),[te,ce]);const a=()=>{e&&(async e=>{if(oe&&e&&ce){ae(!0),ie("");try{const r=localStorage.getItem("adminEmail");if(!r)throw new Error("Admin session not found. Please log in again.");try{const t=await(0,J.BE)(r,e);if(t.error)return ie(t.error.message||"Invalid password"),void ae(!1);await je(oe,ce),re(!1)}catch(t){console.error("Authentication error:",t),ie("Authentication failed. Please try again."),ae(!1)}}catch(t){console.error("Confirmation error:",t),ie(t.message)}finally{ae(!1)}}})(e)};return(0,M.jsxs)(d.A,{open:te,onClose:()=>!se&&re(!1),maxWidth:"xs",fullWidth:!0,disableEscapeKeyDown:se,children:[(0,M.jsx)(x.A,{sx:{borderBottom:"1px solid #eaeaea",pb:2,fontWeight:500},children:"Confirm Admin Password"}),(0,M.jsxs)(m.A,{sx:{pt:3,pb:1},children:[(0,M.jsxs)(i.A,{variant:"body1",sx:{mb:2},children:["Please enter your password to ",(()=>{switch(ce){case"approve":return"approve";case"reject":return"reject";case"delete":return"delete";default:return"process"}})(),":"]}),(0,M.jsx)(i.A,{variant:"subtitle1",sx:{mb:3,fontWeight:600},children:null===oe||void 0===oe?void 0:oe.email}),(0,M.jsx)(A.A,{inputRef:r,fullWidth:!0,type:"password",label:"Admin Password",variant:"outlined",value:e,onChange:e=>t(e.target.value),onKeyDown:t=>{"Enter"===t.key&&e&&!se&&(t.preventDefault(),a())},error:!!ne,helperText:ne,disabled:se,autoComplete:"current-password",sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused":{boxShadow:"0 0 0 2px rgba(25, 118, 210, 0.2)"}}}})]}),(0,M.jsxs)(j.A,{sx:{px:3,py:2},children:[(0,M.jsx)(o.A,{variant:"outlined",onClick:()=>re(!1),disabled:se,children:"Cancel"}),(0,M.jsx)(o.A,{variant:"contained",color:(()=>{switch(ce){case"approve":default:return"primary";case"reject":case"delete":return"error"}})(),onClick:a,disabled:!e||se,sx:{ml:1,minWidth:"120px"},children:se?(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(f.A,{size:20,sx:{mr:1,color:"white"}}),(0,M.jsx)("span",{children:"Verifying"})]}):`${(ce||"Confirm").charAt(0).toUpperCase()+(ce||"confirm").slice(1)}`})]})]})};return(0,M.jsxs)(v.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,M.jsxs)(n.A,{sx:{display:"flex",flexDirection:ue?"column":"row",justifyContent:"space-between",alignItems:ue?"stretch":"center",mb:4},children:[(0,M.jsx)(i.A,{variant:"h4",sx:{fontWeight:600,color:"primary.main",mt:2,textAlign:"center",fontSize:ue?"1.75rem":"2.125rem",mb:ue?2:0},children:"User Verification"}),(0,M.jsx)(o.A,{variant:"contained",startIcon:(0,M.jsx)(T.A,{}),onClick:()=>xe("/dashboard"),sx:{alignSelf:ue?"stretch":"flex-end"},children:"Back to Dashboard"})]}),(0,M.jsx)(a.A,{elevation:3,sx:{mb:4},children:(0,M.jsxs)(y.A,{value:V,onChange:(e,t)=>{Z(t)},variant:ue?"fullWidth":"standard",sx:{borderBottom:1,borderColor:"divider"},children:[(0,M.jsx)(g.A,{label:"Pending",sx:{py:2}}),(0,M.jsx)(g.A,{label:"Approved",sx:{py:2}}),(0,M.jsx)(g.A,{label:"Rejected",sx:{py:2}})]})}),(0,M.jsx)(A.A,{fullWidth:!0,variant:"outlined",placeholder:"Search by name or email",value:H,onChange:e=>K(e.target.value),sx:{mb:3},InputProps:{startAdornment:(0,M.jsx)(b.A,{position:"start",children:(0,M.jsx)(W.A,{})})}}),ue?(0,M.jsx)(n.A,{children:0===r.length?(0,M.jsxs)(i.A,{align:"center",sx:{my:4,color:"text.secondary"},children:["No ",0===V?"pending":1===V?"approved":"rejected"," requests found"]}):r.map((e=>(0,M.jsxs)(a.A,{elevation:2,sx:{mb:2,p:2,border:"1px solid #eaeaea",backgroundColor:"approved"===e.status?"#f0f7f0":"rejected"===e.status?"#f7f0f0":"white"},children:[(0,M.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,M.jsx)(z.A,{sx:{mr:1,color:"primary.main"}}),(0,M.jsx)(i.A,{variant:"h6",sx:{flexGrow:1},children:e.name||"No Name"})]}),(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(P.A,{sx:{mr:1,fontSize:"1rem",color:"text.secondary"}}),(0,M.jsx)(i.A,{variant:"body2",color:"text.secondary",children:e.email})]}),(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(U.A,{sx:{mr:1,fontSize:"1rem",color:"text.secondary"}}),(0,M.jsx)(i.A,{variant:"body2",color:"text.secondary",children:fe(e.createdAt)})]}),(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",color:"approved"===e.status?"success.main":"rejected"===e.status?"error.main":"warning.main",mt:1},children:["approved"===e.status?(0,M.jsx)(B.A,{sx:{mr:1,fontSize:"1.2rem"}}):"rejected"===e.status?(0,M.jsx)(N.A,{sx:{mr:1,fontSize:"1.2rem"}}):(0,M.jsx)(U.A,{sx:{mr:1,fontSize:"1.2rem"}}),(0,M.jsx)(i.A,{variant:"body1",sx:{fontWeight:600,textTransform:"capitalize"},children:e.status})]})]}),"pending"===e.status&&(0,M.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",mt:2,pt:2,borderTop:"1px solid #eaeaea"},children:[(0,M.jsx)(o.A,{variant:"contained",color:"primary",size:"small",sx:{flex:1,mr:1},onClick:()=>he(e,"approve"),children:"Approve"}),(0,M.jsx)(o.A,{variant:"outlined",color:"error",size:"small",sx:{flex:1,ml:1},onClick:()=>he(e,"reject"),children:"Reject"})]}),(0,M.jsxs)(n.A,{sx:{display:"flex",mt:2,gap:1},children:[(0,M.jsx)(o.A,{variant:"text",fullWidth:!0,onClick:()=>Ae(e),endIcon:(0,M.jsx)(R.A,{}),children:"View Details"}),(0,M.jsx)(o.A,{variant:"text",color:"error",onClick:()=>he(e,"delete"),startIcon:(0,M.jsx)($.A,{}),children:"Delete"})]})]},e.id)))}):(0,M.jsx)(w.A,{component:a.A,children:(0,M.jsxs)(C.A,{children:[(0,M.jsx)(S.A,{children:(0,M.jsxs)(l.A,{sx:{backgroundColor:"primary.main"},children:[(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Name"}),(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Email"}),(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Request Date"}),(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Status"}),(0,M.jsx)(c.A,{sx:{color:"white",fontWeight:600},children:"Actions"})]})}),(0,M.jsx)(k.A,{children:0===r.length?(0,M.jsx)(l.A,{children:(0,M.jsxs)(c.A,{colSpan:5,align:"center",sx:{py:3},children:["No ",0===V?"pending":1===V?"approved":"rejected"," requests found"]})}):r.map((e=>(0,M.jsxs)(l.A,{sx:{backgroundColor:"approved"===e.status?"#f0f7f0":"rejected"===e.status?"#f7f0f0":"white","&:hover":{backgroundColor:"action.hover"}},children:[(0,M.jsx)(c.A,{children:e.name||"No Name"}),(0,M.jsx)(c.A,{children:e.email}),(0,M.jsx)(c.A,{children:fe(e.createdAt)}),(0,M.jsx)(c.A,{children:(0,M.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",color:"approved"===e.status?"success.main":"rejected"===e.status?"error.main":"warning.main"},children:["approved"===e.status?(0,M.jsx)(B.A,{sx:{mr:1,fontSize:"small"}}):"rejected"===e.status?(0,M.jsx)(N.A,{sx:{mr:1,fontSize:"small"}}):(0,M.jsx)(U.A,{sx:{mr:1,fontSize:"small"}}),(0,M.jsx)(i.A,{sx:{fontWeight:500,textTransform:"capitalize"},children:e.status})]})}),(0,M.jsxs)(c.A,{children:["pending"===e.status&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(o.A,{variant:"contained",color:"primary",size:"small",sx:{mr:1},onClick:()=>he(e,"approve"),children:"Approve"}),(0,M.jsx)(o.A,{variant:"outlined",color:"error",size:"small",onClick:()=>he(e,"reject"),children:"Reject"})]}),(0,M.jsx)(o.A,{variant:"text",size:"small",sx:{ml:"pending"===e.status?1:0},onClick:()=>Ae(e),children:"Details"}),(0,M.jsx)(o.A,{variant:"text",color:"error",size:"small",sx:{ml:1},onClick:()=>he(e,"delete"),startIcon:(0,M.jsx)($.A,{}),children:"Delete"})]})]},e.id)))})]})}),(0,M.jsx)(ve,{}),(0,M.jsx)(ye,{})]})}}}]);
//# sourceMappingURL=505.4e29493c.chunk.js.map