"use strict";(self.webpackChunkddrops=self.webpackChunkddrops||[]).push([[425],{8425:(e,r,n)=>{n.r(r),n.d(r,{default:()=>L});var i=n(5043),t=n(8076),s=n(2420),o=n(5865),a=n(7392),c=n(35),d=n(6600),l=n(5316),h=n(1806),x=n(3460),j=n(1906),m=n(9347),A=n(9252),g=n(6446),p=n(5795),u=n(1787),v=n(9650),N=n(3336),S=n(4882),b=n(5472),w=n(6822),y=n(3612),D=n(6360),f=n(3159),I=n(7260),C=n(3216),k=n(3044),P=n(7762);var $=n(3639),F=n(1702),R=n(9786),T=n(3471),U=n(579);const L=()=>{const e=(0,C.Zp)(),[r,n]=(0,i.useState)([]),[L,W]=(0,i.useState)(""),[E,Q]=(0,i.useState)(!1),[B,_]=(0,i.useState)(null),[z]=(0,i.useState)("true"===localStorage.getItem("isAdmin"));(0,i.useEffect)((()=>{G()}),[]);const G=async()=>{try{const e="true"===localStorage.getItem("isTestUser"),r=e?y.B:w.db,i=e?"test_shipments":"shipments",t=(0,b.P)((0,b.rJ)(r,i),(0,b.My)("numericId","desc")),s=(await(0,b.GG)(t)).docs.map((e=>({...e.data(),docId:e.id,id:e.data().id})));n(s)}catch(e){console.error("Error fetching records:",e),n([])}},M=async e=>{try{const r=await(async e=>{const r=new P.Ay,n=(e,n)=>(r.text(20,n,e),n+10),i=async(e,n)=>{if(e)try{const i=100,t=e;return r.addImage(t,"PNG",20,n,i,30),n+35}catch(i){return console.error("Error adding signature:",i),n+10}return n+10};let t=20;return r.setFontSize(16),r.setFont(void 0,"bold"),t=n("Shipping Record Details",t),t+=5,r.setFontSize(12),r.setFont(void 0,"normal"),t=n(`ID: ${e.id||"N/A"}`,t),t=n(`Shipment Code: ${e.shipmentCode||"N/A"}`,t),t=n(`Shipment Date: ${e.shipmentDate||"N/A"}`,t),t+=5,r.setFont(void 0,"bold"),t=n("Item Details",t),r.setFont(void 0,"normal"),t=n(`Item Number: ${e.itemNo||"N/A"}`,t),t=n(`Item Name: ${e.itemName||"N/A"}`,t),t=n(`Lot Number: ${e.lotNumber||"N/A"}`,t),t+=5,r.setFont(void 0,"bold"),t=n("Quantity Information",t),r.setFont(void 0,"normal"),t=n(`Quantities: ${e.quantities||"N/A"}`,t),t=n(`Remaining Quantity: ${e.remainingQuantity||"N/A"}`,t),t=n(`Unit: ${e.unit||"N/A"}`,t),t+=5,r.setFont(void 0,"bold"),t=n("Additional Details",t),r.setFont(void 0,"normal"),t=n(`Qualified Manufacturer: ${e.qualifiedManufacturer||"N/A"}`,t),t=n(`Vendor: ${e.vendor||"N/A"}`,t),t=n(`Transportation: ${e.transportation||"N/A"}`,t),t=n(`Landing Bill Number: ${e.landingBillNumber||"N/A"}`,t),t=n(`Expiry Date: ${e.expiryDate||"N/A"}`,t),(e.damageToPackaging||e.damageToProduct)&&(t+=5,r.setFont(void 0,"bold"),t=n("Damage Information",t),r.setFont(void 0,"normal"),t=n("Damage to Packaging: "+(e.damageToPackaging?"Yes":"No"),t),t=n("Damage to Product: "+(e.damageToProduct?"Yes":"No"),t),e.damageNotes&&(t=n(`Damage Notes: ${e.damageNotes}`,t))),t>250&&(r.addPage(),t=20),t+=5,r.setFont(void 0,"bold"),t=n("Signatures",t),r.setFont(void 0,"normal"),e.receiverName&&(t=n("Receiver:",t),t=n(`Name: ${e.receiverName}`,t),t=n(`Date: ${e.receiverDate||"N/A"}`,t),e.receiverSign&&(t=await i(e.receiverSign,t)),t+=5),t>250&&(r.addPage(),t=20),e.inspectorName&&(t=n("Inspector:",t),t=n(`Name: ${e.inspectorName}`,t),t=n(`Date: ${e.inspectorDate||"N/A"}`,t),e.inspectorSign&&(t=await i(e.inspectorSign,t)),t+=5),t>250&&(r.addPage(),t=20),e.approverName&&(t=n("Approver:",t),t=n(`Name: ${e.approverName}`,t),t=n(`Date: ${e.approverDate||"N/A"}`,t),e.approverSign&&(t=await i(e.approverSign,t))),r.output("blob")})(e),n=new Blob([r],{type:"application/pdf"}),i=URL.createObjectURL(n);window.open(i,"_blank"),setTimeout((()=>URL.revokeObjectURL(i)),1e3)}catch(r){console.error("Error generating PDF:",r),alert("Error generating PDF. Please try again.")}},q=r.filter((e=>{const r=e.shipmentCode||"",n=e.itemName||"",i=L.toLowerCase();return r.toString().toLowerCase().includes(i)||n.toString().toLowerCase().includes(i)})),O=r=>(0,U.jsxs)(t.A,{sx:{"&:hover":{backgroundColor:"action.hover"}},children:[(0,U.jsx)(s.A,{children:r.id}),(0,U.jsx)(s.A,{children:r.shipmentCode||"N/A"})," ",(0,U.jsx)(s.A,{children:r.shipmentDate||"N/A"}),(0,U.jsx)(s.A,{children:r.itemName||"N/A"}),(0,U.jsx)(s.A,{children:(0,U.jsx)(o.A,{sx:{color:r.approverSign?"success.main":r.inspectorSign?"info.main":r.receiverSign?"warning.main":"gray",fontWeight:500},children:r.approverSign?"Approved":r.inspectorSign?"Pending Approval":r.receiverSign?"Pending Inspection":"Pending Shipment"})}),(0,U.jsxs)(s.A,{children:[(0,U.jsx)(a.A,{color:"primary",onClick:()=>(r=>{if(r.approverSign)return void alert("Cannot edit an approved record");const n=r.docId;console.log("Editing record with ID:",n),n?e(`/shipping-form?edit=${n}`):alert("Invalid record ID")})(r),disabled:r.approverSign,sx:{mr:1},children:(0,U.jsx)(f.A,{})}),(0,U.jsx)(a.A,{color:"secondary",onClick:()=>(e=>{_(e),Q(!0)})(r),sx:{mr:1},children:(0,U.jsx)(I.A,{})}),(0,U.jsx)(a.A,{color:"primary",onClick:()=>M(r),sx:{mr:1},children:(0,U.jsx)(k.A,{})}),z&&(0,U.jsx)(a.A,{color:"error",onClick:()=>(async r=>{if(z&&window.confirm("Are you sure you want to delete this record? This action cannot be undone."))try{const n="true"===localStorage.getItem("isTestUser")?y.B:w.db,i="true"===localStorage.getItem("isTestUser")?"test_shipments":"shipments";await(0,b.kd)((0,b.H9)(n,i,r.docId)),G(),alert("Record deleted successfully"),e("/dashboard")}catch(n){console.error("Error deleting record:",n),alert("Error deleting record")}})(r),sx:{mr:1},title:"Delete Record",children:(0,U.jsx)(T.A,{})})]})]},r.id||r.docId),Y=()=>(0,U.jsxs)(c.A,{open:E,onClose:()=>Q(!1),maxWidth:"md",fullWidth:!0,children:[(0,U.jsxs)(d.A,{children:["Shipping Record Details - ",null===B||void 0===B?void 0:B.shipmentCode]}),(0,U.jsx)(l.A,{children:B&&(0,U.jsx)(h.A,{children:(0,U.jsxs)(x.A,{children:[(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"ID"})}),(0,U.jsx)(s.A,{children:B.id})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Shipment Code"})}),(0,U.jsx)(s.A,{children:B.shipmentCode})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Shipment Date"})}),(0,U.jsx)(s.A,{children:B.shipmentDate})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Item Number"})}),(0,U.jsx)(s.A,{children:B.itemNo})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Item Name"})}),(0,U.jsx)(s.A,{children:B.itemName})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Lot Number"})}),(0,U.jsx)(s.A,{children:B.lotNumber})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Quantities"})}),(0,U.jsx)(s.A,{children:B.quantities})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Remaining Quantity"})}),(0,U.jsx)(s.A,{children:B.remainingQuantity})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Unit"})}),(0,U.jsx)(s.A,{children:B.unit})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Qualified Manufacturer"})}),(0,U.jsx)(s.A,{children:B.qualifiedManufacturer})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Vendor"})}),(0,U.jsx)(s.A,{children:B.vendor})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Transportation"})}),(0,U.jsx)(s.A,{children:B.transportation})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Landing Bill Number"})}),(0,U.jsx)(s.A,{children:B.landingBillNumber})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Expiry Date"})}),(0,U.jsx)(s.A,{children:B.expiryDate})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Damage to Packaging"})}),(0,U.jsx)(s.A,{children:B.damageToPackaging?"Yes":"No"})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Damage to Product"})}),(0,U.jsx)(s.A,{children:B.damageToProduct?"Yes":"No"})]}),(B.damageToPackaging||B.damageToProduct)&&(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Damage Notes"})}),(0,U.jsx)(s.A,{children:B.damageNotes})]}),B.receiverName&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Receiver Name"})}),(0,U.jsx)(s.A,{children:B.receiverName})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Receiver Date"})}),(0,U.jsx)(s.A,{children:B.receiverDate})]}),B.receiverSign&&(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Receiver Signature"})}),(0,U.jsx)(s.A,{children:(0,U.jsx)("img",{src:B.receiverSign,alt:"Receiver Signature",style:{maxWidth:"200px"}})})]})]}),B.inspectorName&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Inspector Name"})}),(0,U.jsx)(s.A,{children:B.inspectorName})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Inspector Date"})}),(0,U.jsx)(s.A,{children:B.inspectorDate})]}),B.inspectorSign&&(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Inspector Signature"})}),(0,U.jsx)(s.A,{children:(0,U.jsx)("img",{src:B.inspectorSign,alt:"Inspector Signature",style:{maxWidth:"200px"}})})]})]}),B.approverName&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Approver Name"})}),(0,U.jsx)(s.A,{children:B.approverName})]}),(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Approver Date"})}),(0,U.jsx)(s.A,{children:B.approverDate})]}),B.approverSign&&(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Approver Signature"})}),(0,U.jsx)(s.A,{children:(0,U.jsx)("img",{src:B.approverSign,alt:"Approver Signature",style:{maxWidth:"200px"}})})]})]}),B.attachmentUrl&&(0,U.jsxs)(t.A,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)("strong",{children:"Attachment"})}),(0,U.jsx)(s.A,{children:(0,U.jsx)(j.A,{variant:"outlined",size:"small",onClick:()=>{var e;(e=B.attachmentUrl).startsWith("data:application/pdf;base64,")?fetch(e).then((e=>e.blob())).then((e=>{const r=window.URL.createObjectURL(e);window.open(r,"_blank"),window.URL.revokeObjectURL(r)})):window.open(e,"_blank")},children:"View PDF"})})]})]})})}),(0,U.jsx)(m.A,{children:(0,U.jsx)(j.A,{onClick:()=>Q(!1),children:"Close"})})]});return(0,U.jsxs)(A.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,U.jsxs)(g.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{fontWeight:600,color:"primary.main",mt:2},children:"Shipping Records"}),(0,U.jsxs)(g.A,{children:[(0,U.jsx)(j.A,{variant:"contained",startIcon:(0,U.jsx)($.A,{}),onClick:()=>e("/dashboard"),sx:{mr:2,mt:2},children:"Home"}),(0,U.jsx)(j.A,{variant:"outlined",color:"primary",startIcon:(0,U.jsx)(F.A,{}),onClick:async()=>{try{"true"===localStorage.getItem("isTestUser")?(await(async()=>{try{const e=(await(0,b.GG)((0,b.rJ)(y.B,"test_shipments"))).docs.map((e=>(0,b.kd)(e.ref)));await Promise.all(e);const r=y.z.currentUser;r&&await r.delete(),console.log("Test data cleanup completed")}catch(e){console.error("Error cleaning up test data:",e)}})(),await(0,R.CI)(y.z)):await(0,R.CI)(w.j),localStorage.removeItem("isTestUser"),e("/")}catch(r){console.error("Error during logout:",r),localStorage.removeItem("isTestUser"),e("/")}},sx:{mt:2},children:"Logout"})]})]}),(0,U.jsx)(p.A,{fullWidth:!0,variant:"outlined",placeholder:"Search by Shipment Code or Item Name",value:L,onChange:e=>W(e.target.value),sx:{mb:3},InputProps:{startAdornment:(0,U.jsx)(u.A,{position:"start",children:(0,U.jsx)(D.A,{})})}}),(0,U.jsx)(v.A,{component:N.A,children:(0,U.jsxs)(h.A,{children:[(0,U.jsx)(S.A,{children:(0,U.jsxs)(t.A,{sx:{backgroundColor:"primary.main"},children:[(0,U.jsx)(s.A,{sx:{color:"white",fontWeight:600},children:"ID"}),(0,U.jsx)(s.A,{sx:{color:"white",fontWeight:600},children:"Shipment Code"}),"  ",(0,U.jsx)(s.A,{sx:{color:"white",fontWeight:600},children:"Shipment Date"}),(0,U.jsx)(s.A,{sx:{color:"white",fontWeight:600},children:"Item Name"}),(0,U.jsx)(s.A,{sx:{color:"white",fontWeight:600},children:"Status"}),(0,U.jsx)(s.A,{sx:{color:"white",fontWeight:600},children:"Actions"})]})}),(0,U.jsx)(x.A,{children:q.map((e=>O(e)))})]})}),(0,U.jsx)(Y,{})]})}}}]);
//# sourceMappingURL=425.db4ace9e.chunk.js.map